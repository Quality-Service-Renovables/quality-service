import{H as y,q as H,L as U,r as I,o as x,e as k,b as m,w as h,F as q,n as W,c as B,d as O,t as Y,g as X}from"./app-BOTiqfpn.js";import"./sweetalert2.all-Dnr-bOLc.js";import{v as z,b as j,p as K,a as Z}from"./filepond-plugin-image-transform.esm-BtmmAjZI.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";/*!
 * FilePondPluginFilePoster 2.5.1
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */const G={type:"spring",stiffness:.5,damping:.45,mass:10},Q=n=>n.utils.createView({name:"file-poster",tag:"div",ignoreRect:!0,create:({root:e})=>{e.ref.image=document.createElement("img"),e.element.appendChild(e.ref.image)},write:n.utils.createRoute({DID_FILE_POSTER_LOAD:({root:e,props:o})=>{const{id:l}=o,t=e.query("GET_ITEM",{id:o.id});if(!t)return;const s=t.getMetadata("poster");e.ref.image.src=s,e.dispatch("DID_FILE_POSTER_DRAW",{id:l})}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:G,scaleY:G,opacity:{type:"tween",duration:750}}}}),$=(n,e)=>{e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(n,0,0)},ee=n=>n.utils.createView({name:"file-poster-overlay",tag:"canvas",ignoreRect:!0,create:({root:e,props:o})=>{$(o.template,e.element)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),te=(n,e)=>{let o=new Image;o.onload=()=>{const l=o.naturalWidth,t=o.naturalHeight;o=null,e(l,t)},o.src=n},ie=n=>-.5*(Math.cos(Math.PI*n)-1),ne=(n,e,o=1,l=ie,t=10,s=0)=>{const c=1-s,_=e.join(",");for(let d=0;d<=t;d++){const i=d/t,p=s+c*i;n.addColorStop(p,`rgba(${_}, ${l(i)*o})`)}},ae=10,oe=10,le=n=>{const e=Math.min(ae/n.width,oe/n.height),o=document.createElement("canvas"),l=o.getContext("2d"),t=o.width=Math.ceil(n.width*e),s=o.height=Math.ceil(n.height*e);l.drawImage(n,0,0,t,s);let c=null;try{c=l.getImageData(0,0,t,s).data}catch{return null}const _=c.length;let d=0,i=0,p=0,u=0;for(;u<_;u+=4)d+=c[u]*c[u],i+=c[u+1]*c[u+1],p+=c[u+2]*c[u+2];return d=b(d,_),i=b(i,_),p=b(p,_),{r:d,g:i,b:p}},b=(n,e)=>Math.floor(Math.sqrt(n/(e/4))),C=(n,e,o,l,t)=>{n.width=e,n.height=o;const s=n.getContext("2d"),c=e*.5,_=s.createRadialGradient(c,o+110,o-100,c,o+110,o+100);ne(_,l,t,void 0,8,.4),s.save(),s.translate(-e*.5,0),s.scale(2,1),s.fillStyle=_,s.fillRect(0,0,e,o),s.restore()},A=typeof navigator<"u",P=500,R=200,F=A&&document.createElement("canvas"),M=A&&document.createElement("canvas"),V=A&&document.createElement("canvas");let w=[40,40,40],S=[196,78,71],D=[54,151,99];A&&(C(F,P,R,w,.85),C(M,P,R,S,1),C(V,P,R,D,1));const re=(n,e)=>new Promise((o,l)=>{const t=new Image;typeof crossOrigin=="string"&&(t.crossOrigin=e),t.onload=()=>{o(t)},t.onerror=s=>{l(s)},t.src=n}),se=n=>{const e=ee(n),o=({root:i,props:p})=>{const{id:u}=p,f=i.query("GET_ITEM",u);if(!f)return;const v=f.getMetadata("poster"),T=a=>{const r=i.query("GET_FILE_POSTER_CALCULATE_AVERAGE_IMAGE_COLOR")?le(a):null;f.setMetadata("color",r,!0),i.dispatch("DID_FILE_POSTER_LOAD",{id:u,data:a})};te(v,(a,r)=>{i.dispatch("DID_FILE_POSTER_CALCULATE_SIZE",{id:u,width:a,height:r}),re(v,i.query("GET_FILE_POSTER_CROSS_ORIGIN_ATTRIBUTE_VALUE")).then(T)})},l=({root:i})=>{i.ref.overlayShadow.opacity=1},t=({root:i})=>{const{image:p}=i.ref;p.scaleX=1,p.scaleY=1,p.opacity=1},s=({root:i})=>{i.ref.overlayShadow.opacity=1,i.ref.overlayError.opacity=0,i.ref.overlaySuccess.opacity=0},c=({root:i})=>{i.ref.overlayShadow.opacity=.25,i.ref.overlayError.opacity=1},_=({root:i})=>{i.ref.overlayShadow.opacity=.25,i.ref.overlaySuccess.opacity=1},d=({root:i,props:p})=>{const u=i.query("GET_FILE_POSTER_ITEM_OVERLAY_SHADOW_COLOR"),f=i.query("GET_FILE_POSTER_ITEM_OVERLAY_ERROR_COLOR"),v=i.query("GET_FILE_POSTER_ITEM_OVERLAY_SUCCESS_COLOR");u&&u!==w&&(w=u,C(F,P,R,w,.85)),f&&f!==S&&(S=f,C(M,P,R,S,1)),v&&v!==D&&(D=v,C(V,P,R,D,1));const T=Q(n);i.ref.image=i.appendChildView(i.createChildView(T,{id:p.id,scaleX:1.25,scaleY:1.25,opacity:0})),i.ref.overlayShadow=i.appendChildView(i.createChildView(e,{template:F,opacity:0})),i.ref.overlaySuccess=i.appendChildView(i.createChildView(e,{template:V,opacity:0})),i.ref.overlayError=i.appendChildView(i.createChildView(e,{template:M,opacity:0}))};return n.utils.createView({name:"file-poster-wrapper",create:d,write:n.utils.createRoute({DID_FILE_POSTER_LOAD:l,DID_FILE_POSTER_DRAW:t,DID_FILE_POSTER_CONTAINER_CREATE:o,DID_THROW_ITEM_LOAD_ERROR:c,DID_THROW_ITEM_PROCESSING_ERROR:c,DID_THROW_ITEM_INVALID:c,DID_COMPLETE_ITEM_PROCESSING:_,DID_START_ITEM_PROCESSING:s,DID_REVERT_ITEM_PROCESSING:s})})},N=n=>{const{addFilter:e,utils:o}=n,{Type:l,createRoute:t}=o,s=se(n);return e("CREATE_VIEW",c=>{const{is:_,view:d,query:i}=c;if(!_("file")||!i("GET_ALLOW_FILE_POSTER"))return;const p=({root:a,props:r})=>{f(a,r)},u=({root:a,props:r,action:E})=>{/poster/.test(E.change.key)&&f(a,r)},f=(a,r)=>{const{id:E}=r,g=i("GET_ITEM",E);!g||!g.getMetadata("poster")||g.archived||a.ref.previousPoster!==g.getMetadata("poster")&&(a.ref.previousPoster=g.getMetadata("poster"),i("GET_FILE_POSTER_FILTER_ITEM")(g)&&(a.ref.filePoster&&d.removeChildView(a.ref.filePoster),a.ref.filePoster=d.appendChildView(d.createChildView(s,{id:E})),a.dispatch("DID_FILE_POSTER_CONTAINER_CREATE",{id:E})))},v=({root:a,action:r})=>{a.ref.filePoster&&(a.ref.imageWidth=r.width,a.ref.imageHeight=r.height,a.ref.shouldUpdatePanelHeight=!0,a.dispatch("KICK"))},T=({root:a})=>{let r=a.query("GET_FILE_POSTER_HEIGHT");if(r)return r;const E=a.query("GET_FILE_POSTER_MIN_HEIGHT"),g=a.query("GET_FILE_POSTER_MAX_HEIGHT");if(E&&a.ref.imageHeight<E)return E;let L=a.rect.element.width*(a.ref.imageHeight/a.ref.imageWidth);return E&&L<E?E:g&&L>g?g:L};d.registerWriter(t({DID_LOAD_ITEM:p,DID_FILE_POSTER_CALCULATE_SIZE:v,DID_UPDATE_ITEM_METADATA:u},({root:a,props:r})=>{a.ref.filePoster&&(a.rect.element.hidden||a.ref.shouldUpdatePanelHeight&&(a.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:r.id,height:T({root:a})}),a.ref.shouldUpdatePanelHeight=!1))}))}),{options:{allowFilePoster:[!0,l.BOOLEAN],filePosterHeight:[null,l.INT],filePosterMinHeight:[null,l.INT],filePosterMaxHeight:[null,l.INT],filePosterFilterItem:[()=>!0,l.FUNCTION],filePosterCalculateAverageImageColor:[!1,l.BOOLEAN],filePosterCrossOriginAttributeValue:["Anonymous",l.STRING],filePosterItemOverlayShadowColor:[null,l.ARRAY],filePosterItemOverlayErrorColor:[null,l.ARRAY],filePosterItemOverlaySuccessColor:[null,l.ARRAY]}}},ce=typeof window<"u"&&typeof window.document<"u";ce&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:N}));const de=z(Z,K,N,j),ue={props:{inspection_uuid:{type:String,required:!0},evidence:{type:Object,required:!1},positionAux:{type:Number,required:!1}},data(){return{myFiles:[],action:"create",dialogDelete:!1,isHoveredDelete:!1,form:{inspection_uuid:this.inspection_uuid,evidence_store:null,evidence_store_secondary:null,title:null,title_secondary:null,description:null,description_secondary:null,inspection_evidence_secondary:null},formDefault:{inspection_uuid:this.inspection_uuid,evidence_store:null,evidence_store_secondary:null,title:null,title_secondary:null,description:null,description_secondary:null,inspection_evidence_secondary:null},serverConfig:{process:(n,e,o,l,t,s,c)=>{this.form.evidence_store=e;const d=y.CancelToken.source();this.form.title||(H.error("El título es requerido"),this.abort(d)),this.save(d,l,t,s)}}}},mounted(){this.evidence&&(this.action="update",this.form.evidence_store=this.evidence.inspection_evidence,this.form.title=this.evidence.title,this.form.description=this.evidence.description,this.myFiles=[{source:this.evidence.inspection_evidence,options:{type:"remote"}}])},methods:{handleFilePondInit(){},save(n,e,o,l){this.form.position=this.positionAux,this.action==="create"?y.post("api/inspection/evidences",this.form,{headers:{"Content-Type":"multipart/form-data"},cancelToken:n.token,onUploadProgress:t=>{l(t.lengthComputable,t.loaded,t.total)}}).then(t=>{e(t.data.fileId),setTimeout(()=>{this.myFiles=[],this.form=this.formDefault,this.$emit("getEvidences")},2e3)}).catch(t=>{y.isCancel(t)?this.abort(n):(o("Error al subir la información."),this.handleErrors(t))}):this.action==="update"&&y.post("api/inspection/evidences/update/"+this.evidence.inspection_evidence_uuid,this.form,{headers:{"Content-Type":"multipart/form-data"},cancelToken:n.token,onUploadProgress:t=>{l(t.lengthComputable,t.loaded,t.total)}}).then(t=>{e(t.data.fileId),setTimeout(()=>{console.log("Se actualizó la evidencia"),this.$emit("getEvidences")},2e3)}).catch(t=>{y.isCancel(t)?this.abort(n):(o("Error al subir la información."),this.handleErrors(t))})},abort(){source.cancel("Operación cancelada por el usuario.")},deleteEvidence(){console.log("Entro a eliminar"),y.delete("api/inspection/evidences/"+this.evidence.inspection_evidence_uuid).then(n=>{H.success("Evidencia eliminada"),this.$emit("getEvidences")}).catch(n=>{this.handleErrors(n)})}},components:{FilePond:de,Toaster:U}};function pe(n,e,o,l,t,s){const c=I("file-pond"),_=I("v-text-field"),d=I("v-card-title"),i=I("v-textarea"),p=I("v-icon"),u=I("v-btn"),f=I("v-card-actions"),v=I("v-card"),T=I("v-spacer"),a=I("v-dialog");return x(),k(q,null,[m(v,{class:"pb-0",border:"dashed thin dark md"},{default:h(()=>[m(c,{name:"evidence",ref:"pond","label-idle":"Arrastra y suelta tu archivo o <span class='filepond--label-action'>selecciona</span>","allow-multiple":!1,"accepted-file-types":"image/jpeg, image/png",files:t.myFiles,onInit:s.handleFilePondInit,server:t.serverConfig,instantUpload:"false",allowProcess:"true",allowReplace:"true",allowImagePreview:"true",labelInvalidField:"Tipo de archivo no permitido",labelFileLoading:"Cargando",labelFileLoadError:"Error al subir el archivo",labelFileProcessing:"Procesando",labelFileProcessingComplete:"Proceso completado",labelFileProcessingAborted:"Proceso abortado",labelFileProcessingError:"Error al procesar",labelTapToCancel:"Toca para cancelar",labelTapToRetry:"Toca para reintentar",labelTapToUndo:"Toca para deshacer",labelButtonAbortItemLoad:"Cancelar",labelButtonRetryItemLoad:"Reintentar",labelButtonAbortItemProcessing:"Cancelar",labelButtonProcessItem:"Subir",class:W(o.evidence?"min-height":"")},null,8,["files","onInit","server","class"]),m(d,null,{default:h(()=>[m(_,{label:"Título",modelValue:t.form.title,"onUpdate:modelValue":e[0]||(e[0]=r=>t.form.title=r),variant:"outlined","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1}),m(d,{class:"pb-0"},{default:h(()=>[m(i,{label:"Descripción",modelValue:t.form.description,"onUpdate:modelValue":e[1]||(e[1]=r=>t.form.description=r),variant:"outlined",rows:"2","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1}),m(f,{class:"p-0 m-0"},{default:h(()=>[o.evidence?(x(),B(u,{key:0,color:"error",onClick:e[2]||(e[2]=r=>t.dialogDelete=!0),block:"",onMouseover:e[3]||(e[3]=r=>t.isHoveredDelete=!0),onMouseleave:e[4]||(e[4]=r=>t.isHoveredDelete=!1)},{default:h(()=>[m(p,{left:"",class:"text-h5 primary-color"},{default:h(()=>[O(Y(t.isHoveredDelete?"mdi-delete-empty-outline":"mdi-delete-outline"),1)]),_:1})]),_:1})):X("",!0)]),_:1})]),_:1}),m(a,{modelValue:t.dialogDelete,"onUpdate:modelValue":e[7]||(e[7]=r=>t.dialogDelete=r),"max-width":"500px"},{default:h(()=>[m(v,null,{default:h(()=>[m(d,{class:"text-h5 text-center"},{default:h(()=>[O("¿Estás seguro de eliminar?")]),_:1}),m(f,null,{default:h(()=>[m(T),m(u,{color:"blue-darken-1",variant:"text",onClick:e[5]||(e[5]=r=>t.dialogDelete=!1)},{default:h(()=>[O("Cancelar")]),_:1}),m(u,{color:"blue-darken-1",variant:"text",onClick:e[6]||(e[6]=r=>s.deleteEvidence())},{default:h(()=>[O("Si, eliminar")]),_:1}),m(T)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const he=J(ue,[["render",pe],["__scopeId","data-v-9545cf64"]]);export{he as default};
