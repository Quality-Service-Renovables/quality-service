import{Q as M}from"./vue-quill.esm-bundler-BiDZAceM.js";import{_ as W}from"./PrimaryButton-B_dOnAIw.js";import{L as X,H as q,q as I,r as a,o as c,e as _,a as k,b as n,w as o,F,y as U,c as m,d as l,t as p,g as i,I as O,x as z}from"./app-sWZq3O9p.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={components:{QuillEditor:M,PrimaryButton:W,Toaster:X},props:{dialogForm:{type:Boolean,required:!0},ct_inspection_uuid:{type:String,required:!0},inspection_uuid:{type:String,required:!0}},data(){return{dialogFormLoading:!1,sectionsForm:[],expandedPanel:[0,1,2,3,4,5,6],ct_risks:[]}},methods:{getForm(){this.dialogFormLoading=!0,q.get("api/inspection/forms/get-form-inspection/"+this.inspection_uuid).then(t=>{this.dialogFormLoading=!1,this.sectionsForm=t.data.data.sections}).catch(t=>{this.dialogFormLoading=!1,this.handleErrors(t)})},closeSectionDialog(){this.$emit("closeSectionDialog")},saveField(t){t.loading=!0;let d={inspection_uuid:this.inspection_uuid,form:[{inspection_form_value:t.content.inspection_form_value,inspection_form_comments:t.content.inspection_form_comments,ct_inspection_form_uuid:t.ct_inspection_form_uuid,ct_risk_id:t.content.ct_risk_id}]};if(console.log("formData: "),console.log(d),d.form[0].inspection_form_value==null||d.form[0].inspection_form_value==""){I.error("El campo no puede estar vacío"),t.loading=!1;return}else q.post("api/inspection/forms/set-form-inspection",d).then(h=>{t.loading=!1,I.success("Campo guardado correctamente"),h.data.data.length>0?t.content=h.data.data[0]:this.getForm()}).catch(h=>{t.loading=!1,this.handleErrors(h)})},complementData(t){t.content==null?(t.content={inspection_form_value:"",inspection_form_comments:"",ct_risk_id:null},t.switch_comment=!1,t.switch_ct_risk=!1):(t.switch_comment=t.content.inspection_form_comments!==""&&t.content.inspection_form_comments!==null&&t.content.inspection_form_comments!=="<p><br></p>",t.switch_ct_risk=!!(t.content.ct_risk_id&&t.content.ct_risk_id!==null))},isEmptyField(t){return t.content.inspection_form_value==null||t.content.inspection_form_value==""},getRisks(){q.get("api/risks").then(t=>{this.ct_risks=t.data.data}).catch(t=>{this.handleErrors(t)})},getBgColor(t){let d=this.ct_risks.filter(h=>t===h.ct_risk_id);return d.length>0?d[0].ct_color:""},setRiesgo(t){t.switch_ct_risk==!0?(t.switch_ct_risk=!1,t.content.ct_risk_id=null):t.switch_ct_risk==!1&&(t.switch_ct_risk=!0)}},mounted(){this.getForm(),this.getRisks()}},$={class:"max-w-7xl mx-auto sm:px-4 lg:px-6 mb-5 pb-5"},S={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},tt={key:0},et={class:"d-flex align-center"},ot={class:"d-flex align-center gap-5"},nt={class:"text-grey"},st={key:0,class:"mt-3 text-grey"},ct={key:2,class:"mt-3 text-grey"},at={key:1},lt={key:0},it={class:"d-flex align-center"},rt={class:"d-flex align-center gap-5"},_t={class:"text-grey"},mt={key:0,class:"mt-3 text-grey"},dt={key:2,class:"mt-3 text-grey"};function ut(t,d,h,pt,v,u){const y=a("v-chip"),w=a("v-card-subtitle"),D=a("v-expansion-panel-title"),x=a("v-switch"),f=a("v-icon"),L=a("v-card-title"),V=a("QuillEditor"),P=a("v-list-item"),T=a("v-select"),b=a("PrimaryButton"),B=a("v-card-text"),E=a("v-card"),N=a("v-expansion-panel-text"),Q=a("v-expansion-panel"),j=a("v-expansion-panels"),H=a("v-col"),A=a("v-row"),J=a("v-container");return c(),_("div",$,[k("div",S,[n(E,{loading:v.dialogFormLoading},{default:o(()=>[n(B,{class:"padding-0"},{default:o(()=>[n(J,null,{default:o(()=>[n(A,null,{default:o(()=>[n(H,{cols:"12",class:"padding-0"},{default:o(()=>[n(j,{multiple:"",modelValue:v.expandedPanel,"onUpdate:modelValue":d[0]||(d[0]=g=>v.expandedPanel=g)},{default:o(()=>[(c(!0),_(F,null,U(v.sectionsForm,(g,K)=>(c(),m(Q,{key:K,class:"my-5",expanded:!0},{default:o(()=>[n(D,{class:"text-h6"},{default:o(()=>[n(y,{variant:"elevated"},{default:o(()=>[l(p(g.section_details.ct_inspection_section),1)]),_:2},1024),n(w,{class:"ml-2 mt-0 pt-0"},{default:o(()=>[l(" Sección ")]),_:1})]),_:2},1024),n(N,null,{default:o(()=>[g.fields?(c(),_("div",tt,[(c(!0),_(F,null,U(g.fields,(s,R)=>(c(),m(E,{key:R,class:"my-5",loading:s.loading},{default:o(()=>[l(p(u.complementData(s))+" ",1),n(L,{class:"d-flex justify-between"},{default:o(()=>[k("div",et,[n(y,null,{default:o(()=>[l(p(s.ct_inspection_form),1)]),_:2},1024),n(w,null,{default:o(()=>[l("Campo")]),_:1})]),k("div",ot,[n(x,{modelValue:s.switch_comment,"onUpdate:modelValue":e=>s.switch_comment=e,color:"red",label:"Comentario","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),n(x,{modelValue:s.switch_ct_risk,"onUpdate:modelValue":e=>s.switch_ct_risk=e,color:"red",label:"Riesgo","hide-details":"",onClick:e=>u.setRiesgo(s)},null,8,["modelValue","onUpdate:modelValue","onClick"]),s.content.inspection_form_value?(c(),m(f,{key:0,color:"success"},{default:o(()=>[l("mdi-check")]),_:1})):i("",!0),u.isEmptyField(s)&&s.required?(c(),m(f,{key:1,color:"red"},{default:o(()=>[l("mdi-alert-circle-outline")]),_:1})):i("",!0)])]),_:2},1024),n(B,{class:"pt-0"},{default:o(()=>[k("p",nt,"Contenido ("+p(s.required?"*Requerido":"Opcional")+"):",1),n(V,{content:s.content.inspection_form_value,"onUpdate:content":e=>s.content.inspection_form_value=e,theme:"snow",toolbar:"essential",heigth:"100%",contentType:"html"},null,8,["content","onUpdate:content"]),s.switch_comment?(c(),_("p",st," Comentarios:")):i("",!0),s.switch_comment?(c(),m(V,{key:1,content:s.content.inspection_form_comments,"onUpdate:content":e=>s.content.inspection_form_comments=e,theme:"snow",toolbar:"essential",heigth:"100%",contentType:"html"},null,8,["content","onUpdate:content"])):i("",!0),s.switch_ct_risk?(c(),_("p",ct," Riesgo:")):i("",!0),s.switch_ct_risk?(c(),m(T,{key:3,modelValue:s.content.ct_risk_id,"onUpdate:modelValue":e=>s.content.ct_risk_id=e,items:v.ct_risks,"item-title":"ct_risk","item-value":"ct_risk_id",variant:"outlined","hide-details":"",class:"w-50 rounded",density:"compact",style:O({"background-color":u.getBgColor(s.content.ct_risk_id)})},{item:o(({props:e,item:C})=>[n(P,z(e,{title:C.raw.ct_risk,style:{"background-color":C.raw.ct_color},value:"ct_risk"}),null,16,["title","style"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","style"])):i("",!0),n(b,{onClick:e=>u.saveField(s),class:"mt-2",disabled:s.loading},{default:o(()=>[l("Guardar ")]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1032,["loading"]))),128))])):i("",!0),g.sub_sections?(c(),_("div",at,[n(j,{multiple:""},{default:o(()=>[(c(!0),_(F,null,U(g.sub_sections,(s,R)=>(c(),m(Q,{key:R,class:"my-5"},{default:o(()=>[n(D,{class:"text-h6"},{default:o(()=>[n(y,{variant:"elevated"},{default:o(()=>[l(p(s.ct_inspection_section),1)]),_:2},1024),n(w,{class:"ml-2 mt-0 pt-0"},{default:o(()=>[l(" Sub-sección ")]),_:1})]),_:2},1024),n(N,null,{default:o(()=>[s.fields?(c(),_("div",lt,[(c(!0),_(F,null,U(s.fields,(e,C)=>(c(),m(E,{key:C,class:"my-5",loading:e.loading},{default:o(()=>[l(p(u.complementData(e))+" ",1),n(L,{class:"d-flex justify-between"},{default:o(()=>[k("div",it,[n(y,null,{default:o(()=>[l(p(e.ct_inspection_form),1)]),_:2},1024),n(w,null,{default:o(()=>[l("Campo")]),_:1})]),k("div",rt,[n(x,{modelValue:e.switch_comment,"onUpdate:modelValue":r=>e.switch_comment=r,color:"red",label:"Comentario","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),n(x,{modelValue:e.switch_ct_risk,"onUpdate:modelValue":r=>e.switch_ct_risk=r,color:"red",label:"Riesgo","hide-details":"",onClick:r=>u.setRiesgo(e)},null,8,["modelValue","onUpdate:modelValue","onClick"]),e.content.inspection_form_value?(c(),m(f,{key:0,color:"success"},{default:o(()=>[l("mdi-check")]),_:1})):i("",!0),u.isEmptyField(e)&&e.required?(c(),m(f,{key:1,color:"red"},{default:o(()=>[l("mdi-alert-circle-outline")]),_:1})):i("",!0)])]),_:2},1024),n(B,{class:"pt-0"},{default:o(()=>[k("p",_t," Contenido ("+p(e.required?"*Requerido":"Opcional")+"):",1),n(V,{content:e.content.inspection_form_value,"onUpdate:content":r=>e.content.inspection_form_value=r,theme:"snow",toolbar:"essential",heigth:"100%",contentType:"html"},null,8,["content","onUpdate:content"]),e.switch_comment?(c(),_("p",mt,"Comentarios: ")):i("",!0),e.switch_comment?(c(),m(V,{key:1,content:e.content.inspection_form_comments,"onUpdate:content":r=>e.content.inspection_form_comments=r,theme:"snow",toolbar:"essential",heigth:"100%",contentType:"html"},null,8,["content","onUpdate:content"])):i("",!0),e.switch_ct_risk?(c(),_("p",dt," Riesgo:")):i("",!0),e.switch_ct_risk?(c(),m(T,{key:3,modelValue:e.content.ct_risk_id,"onUpdate:modelValue":r=>e.content.ct_risk_id=r,items:v.ct_risks,"item-title":"ct_risk","item-value":"ct_risk_id",variant:"outlined","hide-details":"",class:"w-50 rounded",density:"compact",style:O({"background-color":u.getBgColor(e.content.ct_risk_id)})},{item:o(({props:r,item:G})=>[n(P,z(r,{title:G.raw.ct_risk,style:{"background-color":G.raw.ct_color},value:"ct_risk"}),null,16,["title","style"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","style"])):i("",!0),n(b,{onClick:r=>u.saveField(e),class:"mt-2",disabled:e.loading},{default:o(()=>[l(" Guardar")]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1032,["loading"]))),128))])):i("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):i("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])])])}const yt=Y(Z,[["render",ut],["__scopeId","data-v-5b9043b5"]]);export{yt as default};
