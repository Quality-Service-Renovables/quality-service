import{r as n,o as r,e as m,c as y,w as o,d as c,t as x,g as C,m as I,L as N,q as _,a as p,b as e,F as q,y as L}from"./app-CjLPoRMk.js";import P from"./SectionCard-CH_-HH7w.js";import{_ as j}from"./PrimaryButton-B84KU01C.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./FieldCard-QfYRj3GU.js";const A=["type","disabled"],G={__name:"SecondaryButton",props:{type:{type:String,default:"button"},prependIcon:{type:String,default:""},loading:{type:Boolean,default:!1}},setup(i){return(t,d)=>{const f=n("v-icon");return r(),m("button",{type:i.type,class:"inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25 transition ease-in-out duration-150",disabled:i.loading},[i.prependIcon?(r(),y(f,{key:0,class:"mr-2"},{default:o(()=>[c(x(i.prependIcon),1)]),_:1})):C("",!0),I(t.$slots,"default")],8,A)}}},O={components:{Toaster:N,SectionCard:P,PrimaryButton:j,SecondaryButton:G},props:{item:{type:Object,required:!0}},mounted(){console.log(this.item)},data(){return{dialog:!1,sectionForm:{name:""},dialogDeleteSection:!1,sectionToDeleteUuid:null,loading:!1}},methods:{async saveSection(){if(console.log(this.$refs.sectionCardRef),this.$refs.sectionCardRef)await this.$refs.sectionCardRef[0].saveSection("create",this.item.ct_inspection_uuid,this.sectionForm.name,null),this.resetForm();else{const i=()=>axios.post("api/inspection/sections",{ct_inspection_uuid:this.item.ct_inspection_uuid,ct_inspection_section:this.sectionForm.name,ct_inspection_relation_uuid:null});await _.promise(i(),{loading:"Creando sección...",success:t=>(this.resetForm(),this.dialog=!1,this.updateSections(),"Sección creada correctamente"),error:t=>{this.handleErrors(t)}})}},async updateSections(){this.loading=!0,await axios.get(`api/inspection/forms/get-form/${this.item.ct_inspection_uuid}`).then(i=>{this.loading=!1,this.item.template.sections=i.data.data.sections,_.success("Template actualizado correctamente")}).catch(i=>{this.loading=!1,this.handleErrors(data)})},resetForm(){this.dialog=!1,this.sectionForm.name=""},closeDeleteSection(){this.dialogDeleteSection=!1,this.sectionToDeleteUuid=null},deleteSection(i){this.dialogDeleteSection=!0,this.sectionToDeleteUuid=i,console.log("delete section: ",this.sectionToDeleteUuid)},async deleteSectionConfirm(){const i=()=>axios.delete("api/inspection/sections/"+this.sectionToDeleteUuid);await _.promise(i(),{loading:"Eliminando...",success:t=>(this.closeDeleteSection(),"Sección eliminada correctamente"),error:t=>{this.handleErrors(t)}}),await this.updateSections()}}},H={class:"text-h4"},J=p("br",null,null,-1),K={class:"d-flex align-center justify-end mb-2"};function M(i,t,d,f,a,l){const b=n("v-divider"),k=n("PrimaryButton"),D=n("SecondaryButton"),w=n("v-progress-linear"),g=n("v-col"),V=n("SectionCard"),B=n("v-text-field"),F=n("v-row"),U=n("v-card-text"),u=n("v-btn"),v=n("v-card"),h=n("v-dialog"),T=n("v-card-title"),S=n("v-spacer"),R=n("v-card-actions");return r(),m("div",null,[p("p",H,x(d.item.ct_inspection),1),J,e(b),p("div",K,[e(k,{onClick:t[0]||(t[0]=s=>a.dialog=!0),class:"me-2",prependIcon:"mdi-plus"},{default:o(()=>[c(" Agregar sección ")]),_:1}),e(D,{onClick:l.updateSections,prependIcon:"mdi-reload",loading:a.loading},{default:o(()=>[c(" Recargar ")]),_:1},8,["onClick","loading"])]),a.loading?(r(),y(g,{key:0,cols:"12"},{default:o(()=>[e(w,{indeterminate:"",color:"primary"})]),_:1})):C("",!0),(r(!0),m(q,null,L(d.item.template.sections,(s,E)=>(r(),m("div",{key:E},[e(V,{section:s,title:s.section_details.ct_inspection_section,type:"section",inspection:d.item,onUpdateSections:l.updateSections,onDeleteSection:l.deleteSection,ref_for:!0,ref:"sectionCardRef"},null,8,["section","title","inspection","onUpdateSections","onDeleteSection"])]))),128)),e(h,{modelValue:a.dialog,"onUpdate:modelValue":t[3]||(t[3]=s=>a.dialog=s),width:"auto"},{default:o(()=>[e(v,{"min-width":"500","prepend-icon":"mdi-plus",title:"Nueva sección"},{actions:o(()=>[e(u,{class:"ms-auto",text:"Cancelar",onClick:t[2]||(t[2]=s=>a.dialog=!1)}),e(u,{color:"primary",text:"",onClick:l.saveSection},{default:o(()=>[c("Guardar")]),_:1},8,["onClick"])]),default:o(()=>[e(U,null,{default:o(()=>[e(F,{dense:""},{default:o(()=>[e(g,{cols:"12"},{default:o(()=>[e(B,{label:"Nombre*",variant:"outlined",required:"","hide-details":"",modelValue:a.sectionForm.name,"onUpdate:modelValue":t[1]||(t[1]=s=>a.sectionForm.name=s)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(h,{modelValue:a.dialogDeleteSection,"onUpdate:modelValue":t[5]||(t[5]=s=>a.dialogDeleteSection=s),"max-width":"500px"},{default:o(()=>[e(v,null,{default:o(()=>[e(T,{class:"text-h5 text-center"},{default:o(()=>[c("¿Estás seguro de eliminar esta sección?")]),_:1}),e(R,null,{default:o(()=>[e(S),e(u,{color:"blue-darken-1",variant:"text",onClick:l.closeDeleteSection},{default:o(()=>[c("Cancel")]),_:1},8,["onClick"]),e(u,{color:"blue-darken-1",variant:"text",onClick:t[4]||(t[4]=s=>l.deleteSectionConfirm())},{default:o(()=>[c("Si, eliminar")]),_:1}),e(S)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const $=z(O,[["render",M]]);export{$ as default};
