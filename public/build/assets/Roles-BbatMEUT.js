import{L as S,q as h,r as s,o as n,e as _,b as t,w as o,F as p,c as m,a as f,t as v,J as V,d as g,g as C}from"./app-BdA6vgf3.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";const j={components:{Toaster:S},data:()=>({search:"",dialog:!1,headers:[{title:"Nombre",key:"name"},{title:"Acciones",key:"actions",sortable:!1}],editedIndex:-1,editedItem:{id:"",name:""},defaultItem:{id:"",name:""},loadingRoles:!1,roles:[],permissions:[]}),computed:{formTitle(){return this.editedIndex===-1?"Nuevo rol":"Editar rol"}},watch:{dialog(e){e||this.close()}},methods:{editItem(e){this.editedIndex=this.roles.indexOf(e),this.editedItem=Object.assign({},e),this.dialog=!0,this.restorePermissions(),this.checkPermissions()},checkPermissions(){this.editedItem.permissions.forEach(e=>{this.permissions.map(a=>{a.permissions.map(i=>{i.id==e.id&&(i.checked=!0)})})})},restorePermissions(){this.permissions.forEach(e=>{e.checked=!1,e.permissions.forEach(a=>{a.checked=!1})})},close(){this.dialog=!1,this.$nextTick(()=>{console.log("Cambiando estatus en close"),this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save(){console.log("Guardando...");let e=this.extractPermissions();if(console.log(e),this.editedIndex>-1){const a=()=>axios.put("api/auth-guard/role-permissions/"+this.editedItem.id,{name:this.editedItem.name,permissions:e});h.promise(a(),{loading:"Procesando...",success:i=>(this.$inertia.reload(),this.fetchRoles(),this.close(),"Rol actualizado correctamente"),error:i=>{this.handleErrors(i)}})}},fetchRoles(){return this.loadingRoles=!0,axios.get("api/auth-guard/roles").then(e=>{this.roles=e.data.data,this.loadingRoles=!1}).catch(e=>{this.loadingRoles=!1,h.error("Error al cargar el catálogo de roles")})},fetchPermissions(){return axios.get("api/auth-guard/permissions-grouped").then(e=>{this.permissions=e.data.data}).catch(e=>{h.error("Error al cargar el catálogo de permisos")})},extractPermissions(){let e=new Set;return this.permissions.forEach(a=>{a.permissions.forEach(i=>{i.checked&&(e.add(i.id),e.add(a.id))})}),Array.from(e)}},mounted(){this.fetchRoles(),this.fetchPermissions()}},q={class:"text-h5"},z={class:"text-h5"},G={class:"text-h6"};function D(e,a,i,J,H,c){const P=s("Toaster"),k=s("v-text-field"),y=s("v-toolbar-title"),b=s("v-divider"),x=s("v-spacer"),R=s("v-card-title"),r=s("v-col"),E=s("v-checkbox"),u=s("v-row"),T=s("v-container"),w=s("v-card-text"),I=s("v-btn"),N=s("v-card-actions"),B=s("v-card"),U=s("v-dialog"),A=s("v-toolbar"),F=s("v-icon"),L=s("v-data-table");return n(),_(p,null,[t(P,{position:"top-right",richColors:"",visibleToasts:10}),t(u,null,{default:o(()=>[t(r,{cols:"12",sm:"12"},{default:o(()=>[t(L,{headers:e.headers,items:e.roles,"fixed-header":"",search:e.search,loading:e.loadingRoles},{top:o(()=>[t(A,{flat:""},{default:o(()=>[t(y,{class:"ml-1"},{default:o(()=>[t(k,{modelValue:e.search,"onUpdate:modelValue":a[0]||(a[0]=l=>e.search=l),label:"Buscar","hide-details":"",variant:"solo","append-inner-icon":"mdi-magnify",density:"compact"},null,8,["modelValue"])]),_:1}),t(b,{class:"mx-4",inset:"",vertical:""}),t(x),e.checkPermission("roles.update")?(n(),m(U,{key:0,modelValue:e.dialog,"onUpdate:modelValue":a[2]||(a[2]=l=>e.dialog=l),"max-width":"1200px"},{default:o(()=>[t(B,null,{default:o(()=>[t(R,null,{default:o(()=>[f("span",q,v(c.formTitle),1)]),_:1}),t(w,null,{default:o(()=>[t(T,null,{default:o(()=>[t(u,null,{default:o(()=>[t(r,{cols:"12"},{default:o(()=>[t(k,{modelValue:e.editedItem.name,"onUpdate:modelValue":a[1]||(a[1]=l=>e.editedItem.name=l),label:"Nombre del rol",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),t(r,{cols:"12"},{default:o(()=>[t(b)]),_:1}),t(r,{cols:"12"},{default:o(()=>[f("h1",z,'Permisos del rol "'+v(e.editedItem.name)+'"',1)]),_:1}),t(r,{cols:"12"},{default:o(()=>[t(u,null,{default:o(()=>[(n(!0),_(p,null,V(e.permissions,l=>(n(),m(r,{cols:"12",lg:"4",md:"4",sm:"12",key:l.id},{default:o(()=>[f("h1",G,v(l.name),1),(n(!0),_(p,null,V(l.permissions,d=>(n(),m(E,{key:d.id,label:d.name,"hide-details":"",class:"py-0",modelValue:d.checked,"onUpdate:modelValue":O=>d.checked=O},null,8,["label","modelValue","onUpdate:modelValue"]))),128))]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(N,null,{default:o(()=>[t(x),t(I,{color:"blue-darken-1",variant:"text",onClick:c.close},{default:o(()=>[g(" Cancelar ")]),_:1},8,["onClick"]),t(I,{color:"blue-darken-1",variant:"text",onClick:c.save},{default:o(()=>[g(" Guardar ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):C("",!0)]),_:1})]),"item.actions":o(({item:l})=>[e.checkPermission("roles.update")?(n(),m(F,{key:0,class:"me-2",size:"small",onClick:d=>c.editItem(l)},{default:o(()=>[g(" mdi-pencil ")]),_:2},1032,["onClick"])):C("",!0)]),_:1},8,["headers","items","search","loading"])]),_:1})]),_:1})],64)}const Q=$(j,[["render",D]]);export{Q as default};
