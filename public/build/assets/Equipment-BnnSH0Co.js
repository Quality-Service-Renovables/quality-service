import{r as o,o as u,e as E,b as t,u as D,w as i,F as z,L as T,q as m,Z as j,a as c,d as n,c as I,s as B,x as A,t as F,g as v,p as R,h as L}from"./app-BdA6vgf3.js";import{_ as G}from"./AuthenticatedLayout-DtDVFbmL.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-CrZoaW0V.js";const x=a=>(R("data-v-ddac3349"),a=a(),L(),a),H=x(()=>c("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Equipos",-1)),J={class:"py-12"},K={class:"max-w-7xl mx-auto sm:px-4 lg:px-6"},Q={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},W={class:"text-h5"},X=["href"],Y={components:{Toaster:T},props:{equipments:{type:Array,required:!0}},data:()=>({search:"",dialog:!1,dialogDelete:!1,headers:[{title:"Foto",key:"equipment_image",sortable:!1},{title:"Equipo",align:"start",key:"equipment"},{title:"Marca",key:"trademark.trademark"},{title:"Modelo",key:"model.trademark_model"},{title:"No. Serie",key:"serial_number"},{title:"Categoría",key:"category.ct_equipment"},{title:"Estado",key:"status.status"},{title:"Diagrama",key:"equipment_diagram"},{title:"Activo",key:"active"},{title:"Actions",key:"actions",sortable:!1}],editedIndex:-1,editedItem:{equipment_uuid:"",equipment:"",ct_equipment_code:"",trademark_code:"",trademark_model_code:"",status_code:"",serial_number:"",active:!1,manual:null,equipment_image:null,equipment_diagram:null,models:[]},defaultItem:{equipment_uuid:"",equipment:"",ct_equipment_code:"",trademark_code:"",trademark_model_code:"",status_code:"",serial_number:"",active:!1,manual:null,equipment_image:null,equipment_diagram:null,models:[]},trademarks:[],ct_equipments:[],status:[]}),computed:{formTitle(){return this.editedIndex===-1?"Nuevo equipo":"Editar equipo"}},watch:{dialog(a){a||this.close()},dialogDelete(a){a||this.closeDelete()}},methods:{getItem(a){return{equipment_uuid:a.equipment_uuid,equipment:a.equipment,ct_equipment_code:a.category.ct_equipment_code,trademark_code:a.trademark.trademark_code,trademark_model_code:a.model.trademark_model_code,status_code:a.status.status_code,serial_number:a.serial_number,active:a.active,manual:a.manual,equipment_image:a.equipment_image,equipment_diagram:a.equipment_diagram,models:this.trademarks.find(e=>e.trademark_code===a.trademark.trademark_code).models}},editItem(a){this.editedIndex=this.equipments.indexOf(a),a.active=a.active=="1",this.editedItem=Object.assign({},this.getItem(a)),this.editedItem.manual=null,this.editedItem.equipment_image=null,this.editedItem.equipment_diagram=null,this.dialog=!0},deleteItem(a){this.editedIndex=this.equipments.indexOf(a),this.editedItem=Object.assign({},this.getItem(a)),this.dialogDelete=!0},deleteItemConfirm(a){this.equipments.splice(this.editedIndex,1);const e=()=>axios.delete("api/equipments/"+a);m.promise(e,{loading:"Procesando...",success:l=>(this.closeDelete(),"Equipo eliminado correctamente"),error:l=>{this.handleErrors(l)}})},close(){this.dialog=!1,this.$nextTick(()=>{console.log("Cambiando estatus en close"),this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{console.log("Cambiando estatus en closeDelete"),this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save(){let a={equipment:this.editedItem.equipment,ct_equipment_code:this.editedItem.ct_equipment_code,trademark_code:this.editedItem.trademark_code,trademark_model_code:this.editedItem.trademark_model_code,status_code:this.editedItem.status_code,serial_number:this.editedItem.serial_number,active:this.editedItem.active?1:0,manual_storage:this.editedItem.manual,equipment_image_storage:this.editedItem.equipment_image,equipment_diagram_storage:this.editedItem.equipment_diagram};if(this.editedIndex>-1){const e=()=>axios.post("api/equipments/update/"+this.editedItem.equipment_uuid,a,{headers:{"Content-Type":"multipart/form-data"}});m.promise(e(),{loading:"Procesando...",success:l=>(this.close(),this.$inertia.reload(),"Equipo actualizado correctamente"),error:l=>{this.handleErrors(l)}})}else{const e=()=>axios.post("api/equipments",a,{headers:{"Content-Type":"multipart/form-data"}});m.promise(e(),{loading:"Procesando...",success:l=>(this.close(),this.$inertia.reload(),"Equipo creado correctamente"),error:l=>{this.handleErrors(l)}})}},getColor(a){return a?"green":"red"},getTrademarks(){axios.get("api/trademarks").then(a=>{this.trademarks=a.data.data}).catch(a=>{m.error("Error al cargar el catálogo de marcas")})},setTradermarkModels(){this.editedItem.trademark_model_code="",this.editedItem.models=this.trademarks.find(a=>a.trademark_code===this.editedItem.trademark_code).models},getCategories(){axios.get("api/equipment/categories").then(a=>{this.ct_equipments=a.data.data}).catch(a=>{m.error("Error al cargar el catálogo de categorías")})},getStatus(){axios.get("api/status").then(a=>{this.status=a.data.data}).catch(a=>{m.error("Error al cargar el catálogo de estatus")})},downloadManual(a){window.open("../"+a.manual,"_blank")},showImage(a){window.open("../"+a,"_blank")}},mounted(){this.getTrademarks(),this.getCategories(),this.getStatus()}},ee=Object.assign(Y,{__name:"Equipment",setup(a){return(e,l)=>{const b=o("v-avatar"),p=o("v-icon"),h=o("v-text-field"),U=o("v-toolbar-title"),$=o("v-divider"),_=o("v-spacer"),r=o("v-btn"),V=o("v-card-title"),s=o("v-col"),g=o("v-select"),k=o("v-file-input"),P=o("v-switch"),C=o("v-row"),S=o("v-container"),M=o("v-card-text"),y=o("v-card-actions"),f=o("v-card"),w=o("v-dialog"),N=o("v-toolbar"),O=o("v-data-table");return u(),E(z,null,[t(D(T),{position:"top-right",richColors:"",visibleToasts:10}),t(D(j),{title:"Equipments"}),t(G,null,{header:i(()=>[H]),default:i(()=>[c("div",J,[c("div",K,[c("div",Q,[t(f,null,{default:i(()=>[t(C,null,{default:i(()=>[t(s,{cols:"12",sm:"12"},{default:i(()=>[t(O,{headers:e.headers,items:a.equipments,"fixed-header":"",search:e.search},{"item.equipment_image":i(({item:d})=>[t(b,{image:"../../"+d.equipment_image,size:"40",class:"ma-1 avatar",onClick:q=>e.showImage(d.equipment_image)},null,8,["image","onClick"])]),"item.equipment_diagram":i(({item:d})=>[t(b,{image:"../../"+d.equipment_diagram,size:"40",class:"ma-1 avatar",onClick:q=>e.showImage(d.equipment_diagram)},null,8,["image","onClick"])]),"item.active":i(({value:d})=>[t(p,{color:e.getColor(d)},{default:i(()=>[n("mdi-circle-slice-8")]),_:2},1032,["color"])]),top:i(()=>[t(N,{flat:""},{default:i(()=>[t(U,{class:"ml-1"},{default:i(()=>[t(h,{modelValue:e.search,"onUpdate:modelValue":l[0]||(l[0]=d=>e.search=d),label:"Buscar","hide-details":"",variant:"solo","append-inner-icon":"mdi-magnify",density:"compact"},null,8,["modelValue"])]),_:1}),t($,{class:"mx-4",inset:"",vertical:""}),t(_),e.checkPermission("equipments.create")||e.checkPermission("equipments.update")?(u(),I(w,{key:0,modelValue:e.dialog,"onUpdate:modelValue":l[12]||(l[12]=d=>e.dialog=d),"max-width":"500px"},B({default:i(()=>[t(f,null,{default:i(()=>[t(V,null,{default:i(()=>[c("span",W,F(e.formTitle),1)]),_:1}),t(M,null,{default:i(()=>[t(S,null,{default:i(()=>[t(C,null,{default:i(()=>[t(s,{cols:"12"},{default:i(()=>[t(h,{modelValue:e.editedItem.equipment,"onUpdate:modelValue":l[1]||(l[1]=d=>e.editedItem.equipment=d),label:"Nombre",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12"},{default:i(()=>[t(g,{modelValue:e.editedItem.ct_equipment_code,"onUpdate:modelValue":l[2]||(l[2]=d=>e.editedItem.ct_equipment_code=d),items:e.ct_equipments,"item-title":"ct_equipment","item-value":"ct_equipment_code",label:"Categoría",variant:"solo","hide-details":""},null,8,["modelValue","items"])]),_:1}),t(s,{cols:"12"},{default:i(()=>[t(g,{modelValue:e.editedItem.trademark_code,"onUpdate:modelValue":[l[3]||(l[3]=d=>e.editedItem.trademark_code=d),l[4]||(l[4]=d=>e.setTradermarkModels())],items:e.trademarks,"item-title":"trademark","item-value":"trademark_code",label:"Marca",variant:"solo","hide-details":""},null,8,["modelValue","items"])]),_:1}),t(s,{cols:"12"},{default:i(()=>[t(g,{modelValue:e.editedItem.trademark_model_code,"onUpdate:modelValue":l[5]||(l[5]=d=>e.editedItem.trademark_model_code=d),items:e.editedItem.models,"item-title":"trademark_model","item-value":"trademark_model_code",label:"Modelo",variant:"solo","hide-details":""},null,8,["modelValue","items"])]),_:1}),t(s,{cols:"12"},{default:i(()=>[t(g,{modelValue:e.editedItem.status_code,"onUpdate:modelValue":l[6]||(l[6]=d=>e.editedItem.status_code=d),items:e.status,"item-title":"status","item-value":"status_code",label:"Estatus",variant:"solo","hide-details":""},null,8,["modelValue","items"])]),_:1}),t(s,{cols:"12"},{default:i(()=>[t(h,{modelValue:e.editedItem.serial_number,"onUpdate:modelValue":l[7]||(l[7]=d=>e.editedItem.serial_number=d),label:"Número de serie",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12"},{default:i(()=>[t(k,{variant:"solo",label:"Manual",modelValue:e.editedItem.manual,"onUpdate:modelValue":l[8]||(l[8]=d=>e.editedItem.manual=d),accept:".pdf","prepend-icon":"","prepend-inner-icon":"mdi-file-upload","hide-details":""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12"},{default:i(()=>[t(k,{variant:"solo",label:"Imagen",modelValue:e.editedItem.equipment_image,"onUpdate:modelValue":l[9]||(l[9]=d=>e.editedItem.equipment_image=d),accept:"image/*","prepend-icon":"","prepend-inner-icon":"mdi-image-plus","hide-details":""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12"},{default:i(()=>[t(k,{variant:"solo",label:"Diagrama",modelValue:e.editedItem.equipment_diagram,"onUpdate:modelValue":l[10]||(l[10]=d=>e.editedItem.equipment_diagram=d),accept:"image/*","prepend-icon":"","prepend-inner-icon":"mdi-image-plus","hide-details":""},null,8,["modelValue"])]),_:1}),t(s,{cols:"12"},{default:i(()=>[t(P,{label:"Activo",modelValue:e.editedItem.active,"onUpdate:modelValue":l[11]||(l[11]=d=>e.editedItem.active=d),color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(y,null,{default:i(()=>[t(_),t(r,{color:"blue-darken-1",variant:"text",onClick:e.close},{default:i(()=>[n(" Cancelar ")]),_:1},8,["onClick"]),t(r,{color:"blue-darken-1",variant:"text",onClick:e.save},{default:i(()=>[n(" Guardar ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:2},[e.checkPermission("equipments.create")?{name:"activator",fn:i(({props:d})=>[t(r,A({class:"mb-2",color:"primary",dark:""},d,{icon:"mdi-plus"}),null,16)]),key:"0"}:void 0]),1032,["modelValue"])):v("",!0),t(w,{modelValue:e.dialogDelete,"onUpdate:modelValue":l[14]||(l[14]=d=>e.dialogDelete=d),"max-width":"500px"},{default:i(()=>[t(f,null,{default:i(()=>[t(V,{class:"text-h5 text-center"},{default:i(()=>[n("¿Estás seguro de eliminar?")]),_:1}),t(y,null,{default:i(()=>[t(_),t(r,{color:"blue-darken-1",variant:"text",onClick:e.closeDelete},{default:i(()=>[n("Cancel")]),_:1},8,["onClick"]),t(r,{color:"blue-darken-1",variant:"text",onClick:l[13]||(l[13]=d=>e.deleteItemConfirm(e.editedItem.equipment_uuid))},{default:i(()=>[n("Si, eliminar")]),_:1}),t(_)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.actions":i(({item:d})=>[d.manual?(u(),E("a",{key:0,href:d.manual,target:"_blank",class:"v-btn v-btn--depressed"},[t(p,{class:"me-2",size:"small"},{default:i(()=>[n(" mdi-file ")]),_:1})],8,X)):v("",!0),e.checkPermission("equipments.update")?(u(),I(p,{key:1,class:"me-2",size:"small",onClick:q=>e.editItem(d)},{default:i(()=>[n(" mdi-pencil ")]),_:2},1032,["onClick"])):v("",!0),e.checkPermission("equipments.delete")?(u(),I(p,{key:2,class:"me-2",size:"small",onClick:q=>e.deleteItem(d)},{default:i(()=>[n(" mdi-delete ")]),_:2},1032,["onClick"])):v("",!0)]),_:1},8,["headers","items","search"])]),_:1})]),_:1})]),_:1})])])])]),_:1})],64)}}}),le=Z(ee,[["__scopeId","data-v-ddac3349"]]);export{le as default};
