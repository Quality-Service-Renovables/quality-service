import{r as n,o as l,e as m,c as y,w as o,d as a,t as x,g as C,m as E,L as I,q as _,a as p,b as t,F as N,y as L}from"./app-sWZq3O9p.js";import P from"./SectionCard-CLIie_Yu.js";import{_ as j}from"./PrimaryButton-B_dOnAIw.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./FieldCard-DD9YIyPn.js";const A=["type"],G={__name:"SecondaryButton",props:{type:{type:String,default:"button"},prependIcon:{type:String,default:""}},setup(i){return(e,d)=>{const f=n("v-icon");return l(),m("button",{type:i.type,class:"inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25 transition ease-in-out duration-150"},[i.prependIcon?(l(),y(f,{key:0,class:"mr-2"},{default:o(()=>[a(x(i.prependIcon),1)]),_:1})):C("",!0),E(e.$slots,"default")],8,A)}}},O={components:{Toaster:I,SectionCard:P,PrimaryButton:j,SecondaryButton:G},props:{item:{type:Object,required:!0}},mounted(){console.log(this.item)},data(){return{dialog:!1,sectionForm:{name:""},dialogDeleteSection:!1,sectionToDeleteUuid:null,loading:!1}},methods:{async saveSection(){if(console.log(this.$refs.sectionCardRef),this.$refs.sectionCardRef)await this.$refs.sectionCardRef[0].saveSection("create",this.item.ct_inspection_uuid,this.sectionForm.name,null),this.resetForm();else{const i=()=>axios.post("api/inspection/sections",{ct_inspection_uuid:this.item.ct_inspection_uuid,ct_inspection_section:this.sectionForm.name,ct_inspection_relation_uuid:null});await _.promise(i(),{loading:"Creando sección...",success:e=>(this.resetForm(),this.dialog=!1,this.updateSections(),"Sección creada correctamente"),error:e=>{this.handleErrors(e)}})}},async updateSections(){this.loading=!0;const i=()=>axios.get(`api/inspection/forms/get-form/${this.item.ct_inspection_uuid}`);await _.promise(i(),{loading:"Actualizando secciones...",success:e=>(this.loading=!1,this.item.template.sections=e.data.data.sections,"Template actualizado correctamente"),error:e=>{this.handleErrors(e)}})},resetForm(){this.dialog=!1,this.sectionForm.name=""},closeDeleteSection(){this.dialogDeleteSection=!1,this.sectionToDeleteUuid=null},deleteSection(i){this.dialogDeleteSection=!0,this.sectionToDeleteUuid=i,console.log("delete section: ",this.sectionToDeleteUuid)},async deleteSectionConfirm(){const i=()=>axios.delete("api/inspection/sections/"+this.sectionToDeleteUuid);await _.promise(i(),{loading:"Eliminando...",success:e=>(this.closeDeleteSection(),"Sección eliminada correctamente"),error:e=>{this.handleErrors(e)}}),await this.updateSections()}}},H={class:"text-h4"},J=p("br",null,null,-1),K={class:"d-flex align-center justify-end mb-2"};function M(i,e,d,f,c,r){const b=n("v-divider"),k=n("PrimaryButton"),D=n("SecondaryButton"),w=n("v-progress-linear"),g=n("v-col"),V=n("SectionCard"),F=n("v-text-field"),B=n("v-row"),U=n("v-card-text"),u=n("v-btn"),v=n("v-card"),S=n("v-dialog"),T=n("v-card-title"),h=n("v-spacer"),R=n("v-card-actions");return l(),m("div",null,[p("p",H,x(d.item.ct_inspection),1),J,t(b),p("div",K,[t(k,{onClick:e[0]||(e[0]=s=>c.dialog=!0),class:"me-2",prependIcon:"mdi-plus"},{default:o(()=>[a(" Agregar sección ")]),_:1}),t(D,{onClick:r.updateSections,prependIcon:"mdi-reload"},{default:o(()=>[a(" Recargar ")]),_:1},8,["onClick"])]),c.loading?(l(),y(g,{key:0,cols:"12"},{default:o(()=>[t(w,{indeterminate:"",color:"primary"})]),_:1})):C("",!0),(l(!0),m(N,null,L(d.item.template.sections,(s,q)=>(l(),m("div",{key:q},[t(V,{section:s,title:s.section_details.ct_inspection_section,type:"section",inspection:d.item,onUpdateSections:r.updateSections,onDeleteSection:r.deleteSection,ref_for:!0,ref:"sectionCardRef"},null,8,["section","title","inspection","onUpdateSections","onDeleteSection"])]))),128)),t(S,{modelValue:c.dialog,"onUpdate:modelValue":e[3]||(e[3]=s=>c.dialog=s),width:"auto"},{default:o(()=>[t(v,{"min-width":"500","prepend-icon":"mdi-plus",title:"Nueva sección"},{actions:o(()=>[t(u,{class:"ms-auto",text:"Cancelar",onClick:e[2]||(e[2]=s=>c.dialog=!1)}),t(u,{color:"primary",text:"",onClick:r.saveSection},{default:o(()=>[a("Guardar")]),_:1},8,["onClick"])]),default:o(()=>[t(U,null,{default:o(()=>[t(B,{dense:""},{default:o(()=>[t(g,{cols:"12"},{default:o(()=>[t(F,{label:"Nombre*",variant:"outlined",required:"","hide-details":"",modelValue:c.sectionForm.name,"onUpdate:modelValue":e[1]||(e[1]=s=>c.sectionForm.name=s)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(S,{modelValue:c.dialogDeleteSection,"onUpdate:modelValue":e[5]||(e[5]=s=>c.dialogDeleteSection=s),"max-width":"500px"},{default:o(()=>[t(v,null,{default:o(()=>[t(T,{class:"text-h5 text-center"},{default:o(()=>[a("¿Estás seguro de eliminar esta sección?")]),_:1}),t(R,null,{default:o(()=>[t(h),t(u,{color:"blue-darken-1",variant:"text",onClick:r.closeDeleteSection},{default:o(()=>[a("Cancel")]),_:1},8,["onClick"]),t(u,{color:"blue-darken-1",variant:"text",onClick:e[4]||(e[4]=s=>r.deleteSectionConfirm())},{default:o(()=>[a("Si, eliminar")]),_:1}),t(h)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const $=z(O,[["render",M]]);export{$ as default};
