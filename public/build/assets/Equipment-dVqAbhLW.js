import{r as d,o as r,e as E,b as e,u as D,w as i,F as z,L as T,q as p,Z as j,a as c,d as n,c as I,s as B,x as A,t as F,g as v,p as R,h as L}from"./app-_8y27Ypy.js";import{_ as G}from"./AuthenticatedLayout-DvY6jQoQ.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-DTvq1HUc.js";const x=a=>(R("data-v-f0fac2d3"),a=a(),L(),a),H=x(()=>c("h2",{class:"font-semibold text-xl leading-tight"},"Equipos de inspección",-1)),J={class:"py-12"},K={class:"max-w-7xl mx-auto sm:px-4 lg:px-6"},Q={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},W={class:"text-h5"},X=["href"],Y={components:{Toaster:T},props:{equipments:{type:Array,required:!0}},data:()=>({search:"",dialog:!1,dialogDelete:!1,headers:[{title:"Foto",key:"equipment_image",sortable:!1},{title:"Equipo",align:"start",key:"equipment"},{title:"Marca",key:"trademark"},{title:"Modelo",key:"model"},{title:"Categoría",key:"category.ct_equipment"},{title:"Estado",key:"status.status"},{title:"Diagrama",key:"equipment_diagram"},{title:"Activo",key:"active"},{title:"Actions",key:"actions",sortable:!1}],editedIndex:-1,editedItem:{equipment_uuid:"",equipment:"",ct_equipment_code:"",serial_number:"",trademark:"",model:"",status_code:"",active:!0,manual:null,equipment_image:null,equipment_diagram:null},defaultItem:{equipment_uuid:"",equipment:"",ct_equipment_code:"",serial_number:"",trademark:"",model:"",status_code:"",active:!1,manual:null,equipment_image:null,equipment_diagram:null},ct_equipments:[],status:[]}),computed:{formTitle(){return this.editedIndex===-1?"Nuevo equipo":"Editar equipo"}},watch:{dialog(a){a||this.close()},dialogDelete(a){a||this.closeDelete()}},methods:{getItem(a){return{equipment_uuid:a.equipment_uuid,equipment:a.equipment,ct_equipment_code:a.category.ct_equipment_code,trademark:a.trademark,serial_number:a.serial_number,model:a.model,status_code:a.status.status_code,active:a.active,manual:a.manual,equipment_image:a.equipment_image,equipment_diagram:a.equipment_diagram}},editItem(a){this.editedIndex=this.equipments.indexOf(a),a.active=a.active=="1",this.editedItem=Object.assign({},this.getItem(a)),this.editedItem.manual=null,this.editedItem.equipment_image=null,this.editedItem.equipment_diagram=null,this.dialog=!0},deleteItem(a){this.editedIndex=this.equipments.indexOf(a),this.editedItem=Object.assign({},this.getItem(a)),this.dialogDelete=!0},deleteItemConfirm(a){this.equipments.splice(this.editedIndex,1);const t=()=>axios.delete("api/equipments/"+a);p.promise(t,{loading:"Procesando...",success:o=>(this.closeDelete(),"Equipo eliminado correctamente"),error:o=>{this.handleErrors(o)}})},close(){this.dialog=!1,this.$nextTick(()=>{console.log("Cambiando estatus en close"),this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{console.log("Cambiando estatus en closeDelete"),this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save(){let a={equipment:this.editedItem.equipment,ct_equipment_code:this.editedItem.ct_equipment_code,serial_number:this.editedItem.serial_number,trademark:this.editedItem.trademark,model:this.editedItem.model,status_code:this.editedItem.status_code,active:this.editedItem.active?1:0,manual_storage:this.editedItem.manual,equipment_image_storage:this.editedItem.equipment_image,equipment_diagram_storage:this.editedItem.equipment_diagram};if(this.editedIndex>-1){const t=()=>axios.post("api/equipments/update/"+this.editedItem.equipment_uuid,a,{headers:{"Content-Type":"multipart/form-data"}});p.promise(t(),{loading:"Procesando...",success:o=>(this.close(),this.$inertia.reload(),"Equipo actualizado correctamente"),error:o=>{this.handleErrors(o)}})}else{const t=()=>axios.post("api/equipments",a,{headers:{"Content-Type":"multipart/form-data"}});p.promise(t(),{loading:"Procesando...",success:o=>(this.close(),this.$inertia.reload(),"Equipo creado correctamente"),error:o=>{this.handleErrors(o)}})}},getColor(a){return a?"green":"red"},getCategories(){axios.get("api/equipment/categories").then(a=>{this.ct_equipments=a.data.data}).catch(a=>{p.error("Error al cargar el catálogo de categorías")})},getStatus(){axios.get("api/status").then(a=>{this.status=a.data.data}).catch(a=>{p.error("Error al cargar el catálogo de estatus")})},downloadManual(a){window.open("../"+a.manual,"_blank")},showImage(a){window.open("../"+a,"_blank")}},mounted(){this.getCategories(),this.getStatus()}},ee=Object.assign(Y,{__name:"Equipment",setup(a){return(t,o)=>{const b=d("v-avatar"),_=d("v-icon"),m=d("v-text-field"),U=d("v-toolbar-title"),$=d("v-divider"),g=d("v-spacer"),u=d("v-btn"),k=d("v-card-title"),s=d("v-col"),V=d("v-select"),h=d("v-file-input"),P=d("v-switch"),C=d("v-row"),S=d("v-container"),M=d("v-card-text"),y=d("v-card-actions"),f=d("v-card"),w=d("v-dialog"),N=d("v-toolbar"),O=d("v-data-table");return r(),E(z,null,[e(D(T),{position:"top-right",richColors:"",visibleToasts:10}),e(D(j),{title:"Equipos"}),e(G,null,{header:i(()=>[H]),default:i(()=>[c("div",J,[c("div",K,[c("div",Q,[e(f,null,{default:i(()=>[e(C,null,{default:i(()=>[e(s,{cols:"12",sm:"12"},{default:i(()=>[e(O,{headers:t.headers,items:a.equipments,"fixed-header":"",search:t.search,mobile:t.isMobile()},{"item.equipment_image":i(({item:l})=>[e(b,{image:"../../"+l.equipment_image,size:"40",class:"ma-1 avatar",onClick:q=>t.showImage(l.equipment_image)},null,8,["image","onClick"])]),"item.equipment_diagram":i(({item:l})=>[e(b,{image:"../../"+l.equipment_diagram,size:"40",class:"ma-1 avatar",onClick:q=>t.showImage(l.equipment_diagram)},null,8,["image","onClick"])]),"item.active":i(({value:l})=>[e(_,{color:t.getColor(l)},{default:i(()=>[n("mdi-circle-slice-8")]),_:2},1032,["color"])]),top:i(()=>[e(N,{flat:""},{default:i(()=>[e(U,{class:"ml-1"},{default:i(()=>[e(m,{modelValue:t.search,"onUpdate:modelValue":o[0]||(o[0]=l=>t.search=l),label:"Buscar","hide-details":"",variant:"solo","append-inner-icon":"mdi-magnify",density:"compact"},null,8,["modelValue"])]),_:1}),e($,{class:"mx-4",inset:"",vertical:""}),e(g),t.hasPermissionTo("equipments.create")||t.hasPermissionTo("equipments.update")?(r(),I(w,{key:0,modelValue:t.dialog,"onUpdate:modelValue":o[11]||(o[11]=l=>t.dialog=l),"max-width":"500px"},B({default:i(()=>[e(f,null,{default:i(()=>[e(k,null,{default:i(()=>[c("span",W,F(t.formTitle),1)]),_:1}),e(M,null,{default:i(()=>[e(S,null,{default:i(()=>[e(C,null,{default:i(()=>[e(s,{cols:"12"},{default:i(()=>[e(m,{modelValue:t.editedItem.equipment,"onUpdate:modelValue":o[1]||(o[1]=l=>t.editedItem.equipment=l),label:"Nombre",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:i(()=>[e(V,{modelValue:t.editedItem.ct_equipment_code,"onUpdate:modelValue":o[2]||(o[2]=l=>t.editedItem.ct_equipment_code=l),items:t.ct_equipments,"item-title":"ct_equipment","item-value":"ct_equipment_code",label:"Categoría",variant:"solo","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(s,{cols:"12"},{default:i(()=>[e(V,{modelValue:t.editedItem.status_code,"onUpdate:modelValue":o[3]||(o[3]=l=>t.editedItem.status_code=l),items:t.status,"item-title":"status","item-value":"status_code",label:"Estatus",variant:"solo","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(s,{cols:"12"},{default:i(()=>[e(m,{modelValue:t.editedItem.serial_number,"onUpdate:modelValue":o[4]||(o[4]=l=>t.editedItem.serial_number=l),label:"Número de serie (opcional)",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:i(()=>[e(m,{modelValue:t.editedItem.trademark,"onUpdate:modelValue":o[5]||(o[5]=l=>t.editedItem.trademark=l),label:"Marca (opcional)",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:i(()=>[e(m,{modelValue:t.editedItem.model,"onUpdate:modelValue":o[6]||(o[6]=l=>t.editedItem.model=l),label:"Modelo (opcional)",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:i(()=>[e(h,{variant:"solo",label:"Manual (opcional)",modelValue:t.editedItem.manual,"onUpdate:modelValue":o[7]||(o[7]=l=>t.editedItem.manual=l),accept:".pdf","prepend-icon":"","prepend-inner-icon":"mdi-file-upload","hide-details":""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:i(()=>[e(h,{variant:"solo",label:"Imagen (opcional)",modelValue:t.editedItem.equipment_image,"onUpdate:modelValue":o[8]||(o[8]=l=>t.editedItem.equipment_image=l),accept:"image/*","prepend-icon":"","prepend-inner-icon":"mdi-image-plus","hide-details":""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:i(()=>[e(h,{variant:"solo",label:"Diagrama (opcional)",modelValue:t.editedItem.equipment_diagram,"onUpdate:modelValue":o[9]||(o[9]=l=>t.editedItem.equipment_diagram=l),accept:"image/*","prepend-icon":"","prepend-inner-icon":"mdi-image-plus","hide-details":""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12"},{default:i(()=>[e(P,{label:"Activo",modelValue:t.editedItem.active,"onUpdate:modelValue":o[10]||(o[10]=l=>t.editedItem.active=l),color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(y,null,{default:i(()=>[e(g),e(u,{color:"blue-darken-1",variant:"text",onClick:t.close},{default:i(()=>[n(" Cancelar ")]),_:1},8,["onClick"]),e(u,{color:"blue-darken-1",variant:"text",onClick:t.save},{default:i(()=>[n(" Guardar ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:2},[t.hasPermissionTo("equipments.create")?{name:"activator",fn:i(({props:l})=>[e(u,A({class:"mb-2",color:"primary",dark:""},l,{icon:"mdi-plus"}),null,16)]),key:"0"}:void 0]),1032,["modelValue"])):v("",!0),e(w,{modelValue:t.dialogDelete,"onUpdate:modelValue":o[13]||(o[13]=l=>t.dialogDelete=l),"max-width":"500px"},{default:i(()=>[e(f,null,{default:i(()=>[e(k,{class:"text-h5 text-center"},{default:i(()=>[n("¿Estás seguro de eliminar?")]),_:1}),e(y,null,{default:i(()=>[e(g),e(u,{color:"blue-darken-1",variant:"text",onClick:t.closeDelete},{default:i(()=>[n("Cancel")]),_:1},8,["onClick"]),e(u,{color:"blue-darken-1",variant:"text",onClick:o[12]||(o[12]=l=>t.deleteItemConfirm(t.editedItem.equipment_uuid))},{default:i(()=>[n("Si, eliminar")]),_:1}),e(g)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.actions":i(({item:l})=>[l.manual?(r(),E("a",{key:0,href:l.manual,target:"_blank",class:"v-btn v-btn--depressed"},[e(_,{class:"me-2",size:"small"},{default:i(()=>[n(" mdi-file ")]),_:1})],8,X)):v("",!0),t.hasPermissionTo("equipments.update")?(r(),I(_,{key:1,class:"me-2",size:"small",onClick:q=>t.editItem(l)},{default:i(()=>[n(" mdi-pencil ")]),_:2},1032,["onClick"])):v("",!0),t.hasPermissionTo("equipments.delete")?(r(),I(_,{key:2,class:"me-2",size:"small",onClick:q=>t.deleteItem(l)},{default:i(()=>[n(" mdi-delete ")]),_:2},1032,["onClick"])):v("",!0)]),_:1},8,["headers","items","search","mobile"])]),_:1})]),_:1})]),_:1})])])])]),_:1})],64)}}}),oe=Z(ee,[["__scopeId","data-v-f0fac2d3"]]);export{oe as default};
