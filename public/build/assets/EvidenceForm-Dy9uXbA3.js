import{L as W,H as C,q as k,r as I,o as S,e as B,c as w,w as f,b as s,F as Y,a as U,n as X,g as G,d as O,t as z,p as j,h as K}from"./app-D4wGiOJT.js";import"./sweetalert2.all-DUHnw1ga.js";import{v as Z,p as J,a as Q,b as $}from"./filepond-plugin-image-transform.esm-BW05sS84.js";import ee from"./ImageEditor-NZ6Tut5k.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./PrimaryButton-Dhr6-raH.js";/*!
 * FilePondPluginFilePoster 2.5.1
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */const N={type:"spring",stiffness:.5,damping:.45,mass:10},ie=i=>i.utils.createView({name:"file-poster",tag:"div",ignoreRect:!0,create:({root:t})=>{t.ref.image=document.createElement("img"),t.element.appendChild(t.ref.image)},write:i.utils.createRoute({DID_FILE_POSTER_LOAD:({root:t,props:o})=>{const{id:r}=o,e=t.query("GET_ITEM",{id:o.id});if(!e)return;const l=e.getMetadata("poster");t.ref.image.src=l,t.dispatch("DID_FILE_POSTER_DRAW",{id:r})}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:N,scaleY:N,opacity:{type:"tween",duration:750}}}}),ae=(i,t)=>{t.width=i.width,t.height=i.height,t.getContext("2d").drawImage(i,0,0)},ne=i=>i.utils.createView({name:"file-poster-overlay",tag:"canvas",ignoreRect:!0,create:({root:t,props:o})=>{ae(o.template,t.element)},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}}),oe=(i,t)=>{let o=new Image;o.onload=()=>{const r=o.naturalWidth,e=o.naturalHeight;o=null,t(r,e)},o.src=i},le=i=>-.5*(Math.cos(Math.PI*i)-1),re=(i,t,o=1,r=le,e=10,l=0)=>{const c=1-l,d=t.join(",");for(let u=0;u<=e;u++){const a=u/e,_=l+c*a;i.addColorStop(_,`rgba(${d}, ${r(a)*o})`)}},se=10,ce=10,de=i=>{const t=Math.min(se/i.width,ce/i.height),o=document.createElement("canvas"),r=o.getContext("2d"),e=o.width=Math.ceil(i.width*t),l=o.height=Math.ceil(i.height*t);r.drawImage(i,0,0,e,l);let c=null;try{c=r.getImageData(0,0,e,l).data}catch{return null}const d=c.length;let u=0,a=0,_=0,p=0;for(;p<d;p+=4)u+=c[p]*c[p],a+=c[p+1]*c[p+1],_+=c[p+2]*c[p+2];return u=V(u,d),a=V(a,d),_=V(_,d),{r:u,g:a,b:_}},V=(i,t)=>Math.floor(Math.sqrt(i/(t/4))),P=(i,t,o,r,e)=>{i.width=t,i.height=o;const l=i.getContext("2d"),c=t*.5,d=l.createRadialGradient(c,o+110,o-100,c,o+110,o+100);re(d,r,e,void 0,8,.4),l.save(),l.translate(-t*.5,0),l.scale(2,1),l.fillStyle=d,l.fillRect(0,0,t,o),l.restore()},F=typeof navigator<"u",R=500,D=200,M=F&&document.createElement("canvas"),x=F&&document.createElement("canvas"),H=F&&document.createElement("canvas");let A=[40,40,40],L=[196,78,71],b=[54,151,99];F&&(P(M,R,D,A,.85),P(x,R,D,L,1),P(H,R,D,b,1));const ue=(i,t)=>new Promise((o,r)=>{const e=new Image;typeof crossOrigin=="string"&&(e.crossOrigin=t),e.onload=()=>{o(e)},e.onerror=l=>{r(l)},e.src=i}),pe=i=>{const t=ne(i),o=({root:a,props:_})=>{const{id:p}=_,g=a.query("GET_ITEM",p);if(!g)return;const v=g.getMetadata("poster"),y=n=>{const m=a.query("GET_FILE_POSTER_CALCULATE_AVERAGE_IMAGE_COLOR")?de(n):null;g.setMetadata("color",m,!0),a.dispatch("DID_FILE_POSTER_LOAD",{id:p,data:n})};oe(v,(n,m)=>{a.dispatch("DID_FILE_POSTER_CALCULATE_SIZE",{id:p,width:n,height:m}),ue(v,a.query("GET_FILE_POSTER_CROSS_ORIGIN_ATTRIBUTE_VALUE")).then(y)})},r=({root:a})=>{a.ref.overlayShadow.opacity=1},e=({root:a})=>{const{image:_}=a.ref;_.scaleX=1,_.scaleY=1,_.opacity=1},l=({root:a})=>{a.ref.overlayShadow.opacity=1,a.ref.overlayError.opacity=0,a.ref.overlaySuccess.opacity=0},c=({root:a})=>{a.ref.overlayShadow.opacity=.25,a.ref.overlayError.opacity=1},d=({root:a})=>{a.ref.overlayShadow.opacity=.25,a.ref.overlaySuccess.opacity=1},u=({root:a,props:_})=>{const p=a.query("GET_FILE_POSTER_ITEM_OVERLAY_SHADOW_COLOR"),g=a.query("GET_FILE_POSTER_ITEM_OVERLAY_ERROR_COLOR"),v=a.query("GET_FILE_POSTER_ITEM_OVERLAY_SUCCESS_COLOR");p&&p!==A&&(A=p,P(M,R,D,A,.85)),g&&g!==L&&(L=g,P(x,R,D,L,1)),v&&v!==b&&(b=v,P(H,R,D,b,1));const y=ie(i);a.ref.image=a.appendChildView(a.createChildView(y,{id:_.id,scaleX:1.25,scaleY:1.25,opacity:0})),a.ref.overlayShadow=a.appendChildView(a.createChildView(t,{template:M,opacity:0})),a.ref.overlaySuccess=a.appendChildView(a.createChildView(t,{template:H,opacity:0})),a.ref.overlayError=a.appendChildView(a.createChildView(t,{template:x,opacity:0}))};return i.utils.createView({name:"file-poster-wrapper",create:u,write:i.utils.createRoute({DID_FILE_POSTER_LOAD:r,DID_FILE_POSTER_DRAW:e,DID_FILE_POSTER_CONTAINER_CREATE:o,DID_THROW_ITEM_LOAD_ERROR:c,DID_THROW_ITEM_PROCESSING_ERROR:c,DID_THROW_ITEM_INVALID:c,DID_COMPLETE_ITEM_PROCESSING:d,DID_START_ITEM_PROCESSING:l,DID_REVERT_ITEM_PROCESSING:l})})},q=i=>{const{addFilter:t,utils:o}=i,{Type:r,createRoute:e}=o,l=pe(i);return t("CREATE_VIEW",c=>{const{is:d,view:u,query:a}=c;if(!d("file")||!a("GET_ALLOW_FILE_POSTER"))return;const _=({root:n,props:m})=>{g(n,m)},p=({root:n,props:m,action:h})=>{/poster/.test(h.change.key)&&g(n,m)},g=(n,m)=>{const{id:h}=m,T=a("GET_ITEM",h);!T||!T.getMetadata("poster")||T.archived||n.ref.previousPoster!==T.getMetadata("poster")&&(n.ref.previousPoster=T.getMetadata("poster"),a("GET_FILE_POSTER_FILTER_ITEM")(T)&&(n.ref.filePoster&&u.removeChildView(n.ref.filePoster),n.ref.filePoster=u.appendChildView(u.createChildView(l,{id:h})),n.dispatch("DID_FILE_POSTER_CONTAINER_CREATE",{id:h})))},v=({root:n,action:m})=>{n.ref.filePoster&&(n.ref.imageWidth=m.width,n.ref.imageHeight=m.height,n.ref.shouldUpdatePanelHeight=!0,n.dispatch("KICK"))},y=({root:n})=>{let m=n.query("GET_FILE_POSTER_HEIGHT");if(m)return m;const h=n.query("GET_FILE_POSTER_MIN_HEIGHT"),T=n.query("GET_FILE_POSTER_MAX_HEIGHT");if(h&&n.ref.imageHeight<h)return h;let E=n.rect.element.width*(n.ref.imageHeight/n.ref.imageWidth);return h&&E<h?h:T&&E>T?T:E};u.registerWriter(e({DID_LOAD_ITEM:_,DID_FILE_POSTER_CALCULATE_SIZE:v,DID_UPDATE_ITEM_METADATA:p},({root:n,props:m})=>{n.ref.filePoster&&(n.rect.element.hidden||n.ref.shouldUpdatePanelHeight&&(n.dispatch("DID_UPDATE_PANEL_HEIGHT",{id:m.id,height:y({root:n})}),n.ref.shouldUpdatePanelHeight=!1))}))}),{options:{allowFilePoster:[!0,r.BOOLEAN],filePosterHeight:[null,r.INT],filePosterMinHeight:[null,r.INT],filePosterMaxHeight:[null,r.INT],filePosterFilterItem:[()=>!0,r.FUNCTION],filePosterCalculateAverageImageColor:[!1,r.BOOLEAN],filePosterCrossOriginAttributeValue:["Anonymous",r.STRING],filePosterItemOverlayShadowColor:[null,r.ARRAY],filePosterItemOverlayErrorColor:[null,r.ARRAY],filePosterItemOverlaySuccessColor:[null,r.ARRAY]}}},me=typeof window<"u"&&typeof window.document<"u";me&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:q}));const _e=Z($,Q,q,J),fe={components:{FilePond:_e,Toaster:W,ImageEditor:ee},props:{inspection_uuid:{type:String,required:!0},evidence:{type:Object,required:!1},positionAux:{type:Number,required:!1}},data(){return{myFiles:[],action:"create",dialogDelete:!1,isHoveredDelete:!1,form:{inspection_uuid:this.inspection_uuid,evidence_store:null,evidence_store_secondary:null,title:null,title_secondary:null,description:null,description_secondary:null,inspection_evidence_secondary:null,loading:!1},formDefault:{inspection_uuid:this.inspection_uuid,evidence_store:null,evidence_store_secondary:null,title:null,title_secondary:null,description:null,description_secondary:null,inspection_evidence_secondary:null,loading:!1},serverConfig:{process:(i,t,o,r,e,l,c)=>{this.form.evidence_store=t;const u=C.CancelToken.source();this.form.title||(k.error("El título es requerido"),this.abort(u)),this.save(u,r,e,l)}},editImage:!1}},mounted(){this.evidence&&(this.action="update",this.setEvidence(this.evidence))},methods:{setEvidence(i){this.form.evidence_store=i.inspection_evidence,this.form.title=i.title,this.form.description=i.description,this.form.loading=!1,this.myFiles=[{source:i.inspection_evidence,options:{type:"remote"}}]},handleFilePondInit(){},save(i,t,o,r){this.form.position=this.positionAux,this.action==="create"?C.post("api/inspection/evidences",this.form,{headers:{"Content-Type":"multipart/form-data"},cancelToken:i.token,onUploadProgress:e=>{r(e.lengthComputable,e.loaded,e.total)}}).then(e=>{t(e.data.fileId),setTimeout(()=>{this.myFiles=[],this.form=this.formDefault,this.$emit("getEvidences")},2e3)}).catch(e=>{C.isCancel(e)?this.abort(i):(o("Error al subir la información."),this.handleErrors(e))}):this.action==="update"&&(this.form.loading=!0,C.post("api/inspection/evidences/update/"+this.evidence.inspection_evidence_uuid,this.form,{headers:{"Content-Type":"multipart/form-data"},cancelToken:i.token,onUploadProgress:e=>{r(e.lengthComputable,e.loaded,e.total)}}).then(e=>{t(e.data.fileId),setTimeout(()=>{let l=e.data.data;this.setEvidence(l)},2e3)}).catch(e=>{this.form.loading=!1,C.isCancel(e)?this.abort(i):(o("Error al subir la información."),this.handleErrors(e))}))},abort(){source.cancel("Operación cancelada por el usuario.")},deleteEvidence(){console.log("Entro a eliminar"),C.delete("api/inspection/evidences/"+this.evidence.inspection_evidence_uuid).then(i=>{k.success("Evidencia eliminada"),this.$emit("getEvidences")}).catch(i=>{this.handleErrors(i)})},openEditImageDialog(){this.form.position=this.positionAux,this.editImage=!0},closeEditImageDialog(){this.editImage=!1}}},Ee=i=>(j("data-v-80e1caa7"),i=i(),K(),i),ge={class:"container-img p-0"},he=Ee(()=>U("br",null,null,-1));function ve(i,t,o,r,e,l){const c=I("file-pond"),d=I("v-btn"),u=I("v-text-field"),a=I("v-card-title"),_=I("v-textarea"),p=I("v-icon"),g=I("v-card-actions"),v=I("v-card"),y=I("v-skeleton-loader"),n=I("v-spacer"),m=I("v-dialog"),h=I("ImageEditor"),T=I("v-card-text");return S(),B(Y,null,[e.form.loading?(S(),w(v,{key:1,class:"pb-0",border:"dashed thin dark md"},{default:f(()=>[s(y,{type:"card"}),s(y,{type:"paragraph"}),s(y,{type:"paragraph"}),s(y,{type:"paragraph"}),he]),_:1})):(S(),w(v,{key:0,class:"p-0",border:"dashed thin dark md"},{default:f(()=>[U("div",ge,[s(c,{name:"evidence",ref:"pond","label-idle":"Arrastra y suelta tu archivo o <span class='filepond--label-action'>selecciona</span>","allow-multiple":!1,"accepted-file-types":"image/jpeg, image/png",files:e.myFiles,onInit:l.handleFilePondInit,server:e.serverConfig,instantUpload:"false",allowProcess:"true",allowReplace:"true",allowImagePreview:"true",labelInvalidField:"Tipo de archivo no permitido",labelFileLoading:"Cargando",labelFileLoadError:"Error al subir el archivo",labelFileProcessing:"Procesando",labelFileProcessingComplete:"Proceso completado",labelFileProcessingAborted:"Proceso abortado",labelFileProcessingError:"Error al procesar",labelTapToCancel:"Toca para cancelar",labelTapToRetry:"Toca para reintentar",labelTapToUndo:"Toca para deshacer",labelButtonAbortItemLoad:"Cancelar",labelButtonRetryItemLoad:"Reintentar",labelButtonAbortItemProcessing:"Cancelar",labelButtonProcessItem:"Subir",class:X(o.evidence?"min-height":"")},null,8,["files","onInit","server","class"]),o.evidence?(S(),w(d,{key:0,icon:"mdi-pencil",density:"compact",class:"bg-grey-darken-3 btn-edit",onClick:l.openEditImageDialog},null,8,["onClick"])):G("",!0)]),s(a,null,{default:f(()=>[s(u,{label:"Título",modelValue:e.form.title,"onUpdate:modelValue":t[0]||(t[0]=E=>e.form.title=E),variant:"outlined","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1}),s(a,{class:"pb-0"},{default:f(()=>[s(_,{label:"Descripción",modelValue:e.form.description,"onUpdate:modelValue":t[1]||(t[1]=E=>e.form.description=E),variant:"outlined",rows:"2","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1}),s(g,{class:"p-0 m-0"},{default:f(()=>[o.evidence?(S(),w(d,{key:0,color:"error",onClick:t[2]||(t[2]=E=>e.dialogDelete=!0),block:"",onMouseover:t[3]||(t[3]=E=>e.isHoveredDelete=!0),onMouseleave:t[4]||(t[4]=E=>e.isHoveredDelete=!1)},{default:f(()=>[s(p,{left:"",class:"text-h5 primary-color"},{default:f(()=>[O(z(e.isHoveredDelete?"mdi-delete-empty-outline":"mdi-delete-outline"),1)]),_:1})]),_:1})):G("",!0)]),_:1})]),_:1})),s(m,{modelValue:e.dialogDelete,"onUpdate:modelValue":t[7]||(t[7]=E=>e.dialogDelete=E),"max-width":"500px"},{default:f(()=>[s(v,null,{default:f(()=>[s(a,{class:"text-h5 text-center"},{default:f(()=>[O("¿Estás seguro de eliminar?")]),_:1}),s(g,null,{default:f(()=>[s(n),s(d,{color:"blue-darken-1",variant:"text",onClick:t[5]||(t[5]=E=>e.dialogDelete=!1)},{default:f(()=>[O("Cancelar")]),_:1}),s(d,{color:"blue-darken-1",variant:"text",onClick:t[6]||(t[6]=E=>l.deleteEvidence())},{default:f(()=>[O("Si, eliminar")]),_:1}),s(n)]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(m,{modelValue:e.editImage,"onUpdate:modelValue":t[8]||(t[8]=E=>e.editImage=E),class:"width-edit"},{default:f(()=>[s(v,{title:"Editando imágen de evidencia"},{default:f(()=>[s(T,null,{default:f(()=>[s(h,{evidence:o.evidence,form:e.form,onCloseEditImageDialog:l.closeEditImageDialog,onSetEvidence:l.setEvidence},null,8,["evidence","form","onCloseEditImageDialog","onSetEvidence"])]),_:1}),s(g,null,{default:f(()=>[s(n),s(d,{text:"Cancelar",variant:"text",onClick:l.closeEditImageDialog},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const De=te(fe,[["render",ve],["__scopeId","data-v-80e1caa7"]]);export{De as default};
