import{r as n,o as r,e as m,c as h,w as o,d as c,t as x,g as C,m as R,L as q,q as y,a as _,b as t,F as E,y as L}from"./app-CdXlW3h5.js";import P from"./SectionCard-oXZqkrYf.js";import{_ as j}from"./PrimaryButton-Gkck9oeO.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./FieldCard-wmgN_mm4.js";const A=["type"],G={__name:"SecondaryButton",props:{type:{type:String,default:"button"},prependIcon:{type:String,default:""}},setup(s){return(e,d)=>{const p=n("v-icon");return r(),m("button",{type:s.type,class:"inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-md font-semibold text-xs text-gray-700 uppercase tracking-widest shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-25 transition ease-in-out duration-150"},[s.prependIcon?(r(),h(p,{key:0,class:"mr-2"},{default:o(()=>[c(x(s.prependIcon),1)]),_:1})):C("",!0),R(e.$slots,"default")],8,A)}}},O={components:{Toaster:q,SectionCard:P,PrimaryButton:j,SecondaryButton:G},props:{item:{type:Object,required:!0}},mounted(){console.log(this.item)},data(){return{dialog:!1,sectionForm:{name:""},dialogDeleteSection:!1,sectionToDeleteUuid:null,loading:!1}},methods:{async saveSection(){this.$refs.sectionCardRef&&(await this.$refs.sectionCardRef[0].saveSection("create",this.item.ct_inspection_uuid,this.sectionForm.name,null),this.resetForm())},async updateSections(){this.loading=!0;const s=()=>axios.get(`api/inspection/forms/get-form/${this.item.ct_inspection_uuid}`);await y.promise(s(),{loading:"Actualizando secciones...",success:e=>(this.loading=!1,this.item.template.sections=e.data.data.sections,"Template actualizado correctamente"),error:e=>{this.handleErrors(e)}})},resetForm(){this.dialog=!1,this.sectionForm.name=""},closeDeleteSection(){this.dialogDeleteSection=!1,this.sectionToDeleteUuid=null},deleteSection(s){this.dialogDeleteSection=!0,this.sectionToDeleteUuid=s,console.log("delete section: ",this.sectionToDeleteUuid)},async deleteSectionConfirm(){const s=()=>axios.delete("api/inspection/sections/"+this.sectionToDeleteUuid);await y.promise(s(),{loading:"Eliminando...",success:e=>(this.closeDeleteSection(),"Sección eliminada correctamente"),error:e=>{this.handleErrors(e)}}),await this.updateSections()}}},H={class:"text-h4"},J=_("br",null,null,-1),K={class:"d-flex align-center justify-end mb-2"};function M(s,e,d,p,a,l){const b=n("v-divider"),k=n("PrimaryButton"),D=n("SecondaryButton"),w=n("v-progress-linear"),f=n("v-col"),V=n("SectionCard"),B=n("v-text-field"),F=n("v-row"),U=n("v-card-text"),u=n("v-btn"),g=n("v-card"),v=n("v-dialog"),T=n("v-card-title"),S=n("v-spacer"),I=n("v-card-actions");return r(),m("div",null,[_("p",H,x(d.item.ct_inspection),1),J,t(b),_("div",K,[t(k,{onClick:e[0]||(e[0]=i=>a.dialog=!0),class:"me-2",prependIcon:"mdi-plus"},{default:o(()=>[c(" Agregar sección ")]),_:1}),t(D,{onClick:l.updateSections,prependIcon:"mdi-reload"},{default:o(()=>[c(" Recargar ")]),_:1},8,["onClick"])]),a.loading?(r(),h(f,{key:0,cols:"12"},{default:o(()=>[t(w,{indeterminate:"",color:"primary"})]),_:1})):C("",!0),(r(!0),m(E,null,L(d.item.template.sections,(i,N)=>(r(),m("div",{key:N},[t(V,{section:i,title:i.section_details.ct_inspection_section,type:"section",inspection:d.item,onUpdateSections:l.updateSections,onDeleteSection:l.deleteSection,ref_for:!0,ref:"sectionCardRef"},null,8,["section","title","inspection","onUpdateSections","onDeleteSection"])]))),128)),t(v,{modelValue:a.dialog,"onUpdate:modelValue":e[3]||(e[3]=i=>a.dialog=i),width:"auto"},{default:o(()=>[t(g,{"min-width":"500","prepend-icon":"mdi-plus",title:"Nueva sección"},{actions:o(()=>[t(u,{class:"ms-auto",text:"Cancelar",onClick:e[2]||(e[2]=i=>a.dialog=!1)}),t(u,{color:"primary",text:"",onClick:l.saveSection},{default:o(()=>[c("Guardar")]),_:1},8,["onClick"])]),default:o(()=>[t(U,null,{default:o(()=>[t(F,{dense:""},{default:o(()=>[t(f,{cols:"12"},{default:o(()=>[t(B,{label:"Nombre*",variant:"outlined",required:"","hide-details":"",modelValue:a.sectionForm.name,"onUpdate:modelValue":e[1]||(e[1]=i=>a.sectionForm.name=i)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(v,{modelValue:a.dialogDeleteSection,"onUpdate:modelValue":e[5]||(e[5]=i=>a.dialogDeleteSection=i),"max-width":"500px"},{default:o(()=>[t(g,null,{default:o(()=>[t(T,{class:"text-h5 text-center"},{default:o(()=>[c("¿Estás seguro de eliminar esta sección?")]),_:1}),t(I,null,{default:o(()=>[t(S),t(u,{color:"blue-darken-1",variant:"text",onClick:l.closeDeleteSection},{default:o(()=>[c("Cancel")]),_:1},8,["onClick"]),t(u,{color:"blue-darken-1",variant:"text",onClick:e[4]||(e[4]=i=>l.deleteSectionConfirm())},{default:o(()=>[c("Si, eliminar")]),_:1}),t(S)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const $=z(O,[["render",M]]);export{$ as default};
