import{H as c,q as g,L as F,r as l,o as y,e as k,b as o,w as i,F as x,n as P,c as D,d as u,t as I,g as V}from"./app-CdXlW3h5.js";import"./sweetalert2.all-M4mKF3Ll.js";import{v as w,p as B,a as U}from"./filepond-plugin-image-preview.esm-dR7flX8A.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q=w(U,B),H={props:{inspection_uuid:{type:String,required:!0},evidence:{type:Object,required:!1},position:{type:Number,required:!1}},data(){return{myFiles:[],action:"create",dialogDelete:!1,isHoveredDelete:!1,form:{inspection_uuid:this.inspection_uuid,evidence_store:null,evidence_store_secondary:null,title:"Título",title_secondary:null,description:"Descripción",description_secondary:null,inspection_evidence_secondary:null},formDefault:{inspection_uuid:this.inspection_uuid,evidence_store:null,evidence_store_secondary:null,title:"Título",title_secondary:null,description:"Descripción",description_secondary:null,inspection_evidence_secondary:null},serverConfig:{process:(a,t,s,d,e,p,v)=>{this.form.evidence_store=t;const r=c.CancelToken.source();this.form.title||(g.error("El título es requerido"),this.abort(r)),this.save(r,d,e,p)}}}},mounted(){this.evidence&&(this.action="update",this.form.evidence_store=this.evidence.inspection_evidence,this.form.title=this.evidence.title,this.form.description=this.evidence.description,this.myFiles=[{source:this.evidence.inspection_evidence,options:{type:"remote"}}])},methods:{handleFilePondInit(){},save(a,t,s,d){this.form.position=this.position,this.action==="create"?c.post("api/inspection/evidences",this.form,{headers:{"Content-Type":"multipart/form-data"},cancelToken:a.token,onUploadProgress:e=>{d(e.lengthComputable,e.loaded,e.total)}}).then(e=>{t(e.data.fileId),setTimeout(()=>{this.myFiles=[],this.form=this.formDefault,this.$emit("getEvidences")},2e3)}).catch(e=>{c.isCancel(e)?this.abort(a):(s("Error al subir la información."),this.handleErrors(e))}):this.action==="update"&&c.post("api/inspection/evidences/update/"+this.evidence.inspection_evidence_uuid,this.form,{headers:{"Content-Type":"multipart/form-data"},cancelToken:a.token,onUploadProgress:e=>{d(e.lengthComputable,e.loaded,e.total)}}).then(e=>{t(e.data.fileId),setTimeout(()=>{console.log("Se actualizó la evidencia"),this.$emit("getEvidences")},2e3)}).catch(e=>{c.isCancel(e)?this.abort(a):(s("Error al subir la información."),this.handleErrors(e))})},abort(){source.cancel("Operación cancelada por el usuario.")},deleteEvidence(){console.log("Entro a eliminar"),c.delete("api/inspection/evidences/"+this.evidence.inspection_evidence_uuid).then(a=>{g.success("Evidencia eliminada"),this.$emit("getEvidences")}).catch(a=>{this.handleErrors(a)})}},components:{FilePond:q,Toaster:F}};function N(a,t,s,d,e,p){const v=l("file-pond"),f=l("v-text-field"),r=l("v-card-title"),C=l("v-textarea"),T=l("v-icon"),m=l("v-btn"),_=l("v-card-actions"),h=l("v-card"),b=l("v-spacer"),E=l("v-dialog");return y(),k(x,null,[o(h,{class:"pb-0",border:"dashed thin dark md"},{default:i(()=>[o(v,{name:"evidence",ref:"pond","label-idle":"Arrastra y suelta tu archivo o <span class='filepond--label-action'>selecciona</span>","allow-multiple":!1,"accepted-file-types":"image/jpeg, image/png",files:e.myFiles,onInit:p.handleFilePondInit,server:e.serverConfig,instantUpload:"false",allowProcess:"true",allowReplace:"true",allowImagePreview:"true",labelInvalidField:"Tipo de archivo no permitido",labelFileLoading:"Cargando",labelFileLoadError:"Error al subir el archivo",labelFileProcessing:"Procesando",labelFileProcessingComplete:"Proceso completado",labelFileProcessingAborted:"Proceso abortado",labelFileProcessingError:"Error al procesar",labelTapToCancel:"Toca para cancelar",labelTapToRetry:"Toca para reintentar",labelTapToUndo:"Toca para deshacer",labelButtonAbortItemLoad:"Cancelar",labelButtonRetryItemLoad:"Reintentar",labelButtonAbortItemProcessing:"Cancelar",labelButtonProcessItem:"Subir",class:P(s.evidence?"min-height":"")},null,8,["files","onInit","server","class"]),o(r,null,{default:i(()=>[o(f,{label:"Título",modelValue:e.form.title,"onUpdate:modelValue":t[0]||(t[0]=n=>e.form.title=n),variant:"outlined","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1}),o(r,{class:"pb-0"},{default:i(()=>[o(C,{label:"Descripción",modelValue:e.form.description,"onUpdate:modelValue":t[1]||(t[1]=n=>e.form.description=n),variant:"outlined",rows:"2","hide-details":"",density:"compact"},null,8,["modelValue"])]),_:1}),o(_,{class:"p-0 m-0"},{default:i(()=>[s.evidence?(y(),D(m,{key:0,color:"error",onClick:t[2]||(t[2]=n=>e.dialogDelete=!0),block:"",onMouseover:t[3]||(t[3]=n=>e.isHoveredDelete=!0),onMouseleave:t[4]||(t[4]=n=>e.isHoveredDelete=!1)},{default:i(()=>[o(T,{left:"",class:"text-h5 primary-color"},{default:i(()=>[u(I(e.isHoveredDelete?"mdi-delete-empty-outline":"mdi-delete-outline"),1)]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1}),o(E,{modelValue:e.dialogDelete,"onUpdate:modelValue":t[7]||(t[7]=n=>e.dialogDelete=n),"max-width":"500px"},{default:i(()=>[o(h,null,{default:i(()=>[o(r,{class:"text-h5 text-center"},{default:i(()=>[u("¿Estás seguro de eliminar?")]),_:1}),o(_,null,{default:i(()=>[o(b),o(m,{color:"blue-darken-1",variant:"text",onClick:t[5]||(t[5]=n=>e.dialogDelete=!1)},{default:i(()=>[u("Cancelar")]),_:1}),o(m,{color:"blue-darken-1",variant:"text",onClick:t[6]||(t[6]=n=>p.deleteEvidence())},{default:i(()=>[u("Si, eliminar")]),_:1}),o(b)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const z=L(H,[["render",N],["__scopeId","data-v-383f7287"]]);export{z as default};
