import{Q as W}from"./vue-quill.esm-bundler-CKmas_2N.js";import{_ as X}from"./PrimaryButton-BiwY_VLe.js";import{L as Y,H as R,q as z,r as i,o as s,e as d,a as p,b as n,w as e,F as C,y as V,c as a,d as l,t as g,g as r,J,x as A}from"./app-CYb7PDVD.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $={components:{QuillEditor:W,PrimaryButton:X,Toaster:Y},props:{dialogForm:{type:Boolean,required:!0},ct_inspection_uuid:{type:String,required:!0},inspection_uuid:{type:String,required:!0}},data(){return{dialogFormLoading:!1,sectionsForm:[],expandedPanel:[0,1,2,3,4,5,6],ct_risks:[],suggestions:[]}},methods:{getForm(){this.dialogFormLoading=!0,R.get("api/inspection/forms/get-form-inspection/"+this.inspection_uuid).then(t=>{this.dialogFormLoading=!1,this.sectionsForm=t.data.data.sections}).catch(t=>{this.dialogFormLoading=!1,this.handleErrors(t)})},closeSectionDialog(){this.$emit("closeSectionDialog")},saveField(t){t.loading=!0;let u={inspection_uuid:this.inspection_uuid,form:[{inspection_form_value:t.content.inspection_form_value,inspection_form_comments:t.content.inspection_form_comments,ct_inspection_form_uuid:t.ct_inspection_form_uuid,ct_risk_id:t.content.ct_risk_id}]};if(this.isEmptyField(u.form[0].inspection_form_value)){z.error("El contenido no puede estar vacío"),t.loading=!1;return}else R.post("api/inspection/forms/set-form-inspection",u).then(h=>{t.loading=!1,z.success("Campo guardado correctamente"),h.data.data.length>0?(t.content=h.data.data[0],this.getSuggestions(t)):this.getForm()}).catch(h=>{t.loading=!1,this.handleErrors(h)})},complementData(t){t.content==null?(t.content={inspection_form_value:"",inspection_form_comments:"",ct_risk_id:null},t.switch_comment=!1,t.switch_ct_risk=!1):(t.switch_comment=t.content.inspection_form_comments!==""&&t.content.inspection_form_comments!==null&&t.content.inspection_form_comments!=="<p><br></p>",t.switch_ct_risk=!!(t.content.ct_risk_id&&t.content.ct_risk_id!==null))},isEmptyField(t){return t==null||t==""||t=="<p><br></p>"},getRisks(){R.get("api/risks").then(t=>{this.ct_risks=t.data.data}).catch(t=>{this.handleErrors(t)})},getBgColor(t){let u=this.ct_risks.filter(h=>t===h.ct_risk_id);return u.length>0?u[0].ct_color:""},setRiesgo(t){t.switch_ct_risk==!0?(t.switch_ct_risk=!1,t.content.ct_risk_id=null):t.switch_ct_risk==!1&&(t.switch_ct_risk=!0)},async getSuggestions(t){t.loadingSuggestions=!0,await R.get("api/inspection/forms/get-field-suggestions/"+t.ct_inspection_form_uuid).then(u=>{t.loadingSuggestions=!1,t.suggestions=u.data.data}).catch(u=>{t.loadingSuggestions=!1,this.handleErrors(u)})},setComment(t,u){t.content.inspection_form_comments=u}},mounted(){this.getForm(),this.getRisks()}},S={class:"max-w-7xl mx-auto sm:px-4 lg:px-6 mb-5 pb-5"},tt={class:"overflow-hidden shadow-sm sm:rounded-lg"},et={key:0},ot={class:"d-flex align-center"},nt={class:"d-flex align-center gap-3"},st={class:"text-grey"},ct={key:0,class:"mt-3 text-grey"},at=p("span",{class:"mdi mdi-lightbulb-on-outline"},null,-1),lt=["innerHTML"],it={key:2,class:"mt-3 text-grey"},rt={key:1},_t={key:0},mt={class:"d-flex align-center"},ut={class:"d-lg-flex align-center gap-3"},dt={class:"text-grey"},pt={key:0,class:"mt-3 text-grey"},gt=p("span",{class:"mdi mdi-lightbulb-on-outline"},null,-1),ht=["innerHTML"],kt={key:2,class:"mt-3 text-grey"};function vt(t,u,h,yt,w,m){const U=i("v-chip"),f=i("v-card-subtitle"),D=i("v-expansion-panel-title"),E=i("v-switch"),b=i("v-icon"),P=i("v-card-title"),L=i("QuillEditor"),F=i("v-col"),k=i("v-card"),v=i("v-card-text"),N=i("v-skeleton-loader"),q=i("v-row"),H=i("v-list-item"),M=i("v-select"),Q=i("PrimaryButton"),j=i("v-expansion-panel-text"),G=i("v-expansion-panel"),O=i("v-expansion-panels"),I=i("v-container");return s(),d("div",S,[p("div",tt,[n(k,{loading:w.dialogFormLoading},{default:e(()=>[n(v,{class:"padding-0"},{default:e(()=>[n(I,null,{default:e(()=>[n(q,null,{default:e(()=>[n(F,{cols:"12",class:"padding-0"},{default:e(()=>[n(O,{multiple:"",modelValue:w.expandedPanel,"onUpdate:modelValue":u[0]||(u[0]=y=>w.expandedPanel=y)},{default:e(()=>[(s(!0),d(C,null,V(w.sectionsForm,(y,K)=>(s(),a(G,{key:K,class:"my-5 border",expanded:!0},{default:e(()=>[n(D,{class:"text-h6"},{default:e(()=>[n(U,{color:"primary",variant:"elevated"},{default:e(()=>[l(g(y.section_details.ct_inspection_section),1)]),_:2},1024),n(f,{class:"ml-2 mt-0 pt-0"},{default:e(()=>[l(" Sección ")]),_:1})]),_:2},1024),n(j,null,{default:e(()=>[y.fields?(s(),d("div",et,[(s(!0),d(C,null,V(y.fields,(c,T)=>(s(),a(k,{key:T,class:"my-5 border",loading:c.loading},{default:e(()=>[l(g(m.complementData(c))+" ",1),n(P,{class:"d-lg-flex justify-between"},{default:e(()=>[p("div",ot,[n(U,{color:"primary"},{default:e(()=>[l(g(c.ct_inspection_form),1)]),_:2},1024),n(f,null,{default:e(()=>[l("Campo")]),_:1})]),p("div",nt,[n(E,{modelValue:c.switch_comment,"onUpdate:modelValue":o=>c.switch_comment=o,color:"blue",label:"Comentario","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),n(E,{modelValue:c.switch_ct_risk,"onUpdate:modelValue":o=>c.switch_ct_risk=o,color:"blue",label:"Riesgo","hide-details":"",onClick:o=>m.setRiesgo(c)},null,8,["modelValue","onUpdate:modelValue","onClick"]),m.isEmptyField(c.content.inspection_form_value)?r("",!0):(s(),a(b,{key:0,color:"success"},{default:e(()=>[l("mdi-check")]),_:1})),m.isEmptyField(c.content.inspection_form_value)&&c.required?(s(),a(b,{key:1,color:"red"},{default:e(()=>[l("mdi-alert-circle-outline")]),_:1})):r("",!0)])]),_:2},1024),n(v,{class:"pt-0"},{default:e(()=>[p("p",st,"Contenido ("+g(c.required?"*Requerido":"Opcional")+"):",1),n(L,{content:c.content.inspection_form_value,"onUpdate:content":o=>c.content.inspection_form_value=o,theme:"snow",toolbar:"essential",heigth:"100%",contentType:"html"},null,8,["content","onUpdate:content"]),c.switch_comment?(s(),d("p",ct," Comentarios:")):r("",!0),c.switch_comment?(s(),a(q,{key:1},{default:e(()=>[n(F,{cols:"12",lg:"8"},{default:e(()=>[c.switch_comment?(s(),a(L,{key:0,content:c.content.inspection_form_comments,"onUpdate:content":o=>c.content.inspection_form_comments=o,theme:"snow",toolbar:"essential",contentType:"html",onClick:o=>m.getSuggestions(c)},null,8,["content","onUpdate:content","onClick"])):r("",!0)]),_:2},1024),n(F,{cols:"12",lg:"4"},{default:e(()=>[n(k,{class:"mx-auto border",color:"primary",variant:"outlined"},{default:e(()=>[n(f,{class:"mt-2 mb-0"},{default:e(()=>[at,l(" Sugerencias")]),_:1}),c.loadingSuggestions?(s(),a(N,{key:1,type:"paragraph"})):(s(),a(v,{key:0,class:"py-1 card-suggestions overflow-y-auto"},{default:e(()=>[(s(!0),d(C,null,V(c.suggestions,(o,x)=>(s(),a(k,{variant:"tonal",class:"my-1",key:x,onClick:_=>m.setComment(c,o)},{default:e(()=>[p("div",{class:"m-1",innerHTML:o},null,8,lt)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),c.suggestions?r("",!0):(s(),a(v,{key:2,class:"pt-0 card-suggestions overflow-y-auto"},{default:e(()=>[l("No hay sugerencias")]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)):r("",!0),c.switch_ct_risk?(s(),d("p",it," Riesgo:")):r("",!0),c.switch_ct_risk?(s(),a(M,{key:3,modelValue:c.content.ct_risk_id,"onUpdate:modelValue":o=>c.content.ct_risk_id=o,items:w.ct_risks,"item-title":"ct_risk","item-value":"ct_risk_id",variant:"outlined","hide-details":"",class:"w-50 rounded",density:"compact",style:J({"background-color":m.getBgColor(c.content.ct_risk_id)})},{item:e(({props:o,item:x})=>[n(H,A(o,{title:x.raw.ct_risk,style:{"background-color":x.raw.ct_color},value:"ct_risk"}),null,16,["title","style"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","style"])):r("",!0),n(Q,{onClick:o=>m.saveField(c),class:"mt-2",disabled:c.loading},{default:e(()=>[l("Guardar ")]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1032,["loading"]))),128))])):r("",!0),y.sub_sections?(s(),d("div",rt,[n(O,{multiple:""},{default:e(()=>[(s(!0),d(C,null,V(y.sub_sections,(c,T)=>(s(),a(G,{key:T,class:"my-5 border"},{default:e(()=>[n(D,{class:"text-h6"},{default:e(()=>[n(U,{color:"primary",variant:"elevated"},{default:e(()=>[l(g(c.ct_inspection_section),1)]),_:2},1024),n(f,{class:"ml-2 mt-0 pt-0"},{default:e(()=>[l(" Sub-sección ")]),_:1})]),_:2},1024),n(j,null,{default:e(()=>[c.fields?(s(),d("div",_t,[(s(!0),d(C,null,V(c.fields,(o,x)=>(s(),a(k,{key:x,class:"my-5 border",loading:o.loading},{default:e(()=>[l(g(m.complementData(o))+" ",1),n(P,{class:"d-lg-flex justify-between"},{default:e(()=>[p("div",mt,[n(U,{color:"primary"},{default:e(()=>[l(g(o.ct_inspection_form),1)]),_:2},1024),n(f,null,{default:e(()=>[l("Campo")]),_:1})]),p("div",ut,[n(E,{modelValue:o.switch_comment,"onUpdate:modelValue":_=>o.switch_comment=_,color:"blue",label:"Comentario","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),n(E,{modelValue:o.switch_ct_risk,"onUpdate:modelValue":_=>o.switch_ct_risk=_,color:"blue",label:"Riesgo","hide-details":"",onClick:_=>m.setRiesgo(o)},null,8,["modelValue","onUpdate:modelValue","onClick"]),m.isEmptyField(o.content.inspection_form_value)?r("",!0):(s(),a(b,{key:0,color:"success"},{default:e(()=>[l("mdi-check")]),_:1})),m.isEmptyField(o.content.inspection_form_value)&&o.required?(s(),a(b,{key:1,color:"red"},{default:e(()=>[l("mdi-alert-circle-outline")]),_:1})):r("",!0)])]),_:2},1024),n(v,{class:"pt-0"},{default:e(()=>[p("p",dt," Contenido ("+g(o.required?"*Requerido":"Opcional")+"):",1),n(L,{content:o.content.inspection_form_value,"onUpdate:content":_=>o.content.inspection_form_value=_,theme:"snow",toolbar:"essential",heigth:"100%",contentType:"html"},null,8,["content","onUpdate:content"]),o.switch_comment?(s(),d("p",pt," Comentarios: ")):r("",!0),o.switch_comment?(s(),a(q,{key:1},{default:e(()=>[n(F,{cols:"12",lg:"8"},{default:e(()=>[o.switch_comment?(s(),a(L,{key:0,content:o.content.inspection_form_comments,"onUpdate:content":_=>o.content.inspection_form_comments=_,theme:"snow",toolbar:"essential",heigth:"100%",contentType:"html",onClick:_=>m.getSuggestions(o)},null,8,["content","onUpdate:content","onClick"])):r("",!0)]),_:2},1024),n(F,{cols:"12",lg:"4"},{default:e(()=>[n(k,{class:"mx-auto border",color:"primary",variant:"outlined"},{default:e(()=>[n(f,{class:"mt-2 mb-0"},{default:e(()=>[gt,l(" Sugerencias")]),_:1}),o.loadingSuggestions?(s(),a(N,{key:1,type:"paragraph"})):(s(),a(v,{key:0,class:"py-1 card-suggestions overflow-y-auto"},{default:e(()=>[(s(!0),d(C,null,V(o.suggestions,(_,B)=>(s(),a(k,{variant:"tonal",class:"my-1",key:B,onClick:wt=>m.setComment(o,_)},{default:e(()=>[p("div",{class:"m-1",innerHTML:_},null,8,ht)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),o.suggestions?r("",!0):(s(),a(v,{key:2,class:"pt-0 card-suggestions overflow-y-auto"},{default:e(()=>[l("No hay sugerencias")]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)):r("",!0),o.switch_ct_risk?(s(),d("p",kt," Riesgo:")):r("",!0),o.switch_ct_risk?(s(),a(M,{key:3,modelValue:o.content.ct_risk_id,"onUpdate:modelValue":_=>o.content.ct_risk_id=_,items:w.ct_risks,"item-title":"ct_risk","item-value":"ct_risk_id",variant:"outlined","hide-details":"",class:"w-50 rounded",density:"compact",style:J({"background-color":m.getBgColor(o.content.ct_risk_id)})},{item:e(({props:_,item:B})=>[n(H,A(_,{title:B.raw.ct_risk,style:{"background-color":B.raw.ct_color},value:"ct_risk"}),null,16,["title","style"])]),_:2},1032,["modelValue","onUpdate:modelValue","items","style"])):r("",!0),n(Q,{onClick:_=>m.saveField(o),class:"mt-2",disabled:o.loading},{default:e(()=>[l(" Guardar")]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1032,["loading"]))),128))])):r("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)])):r("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])])])}const Ft=Z($,[["render",vt]]);export{Ft as default};
