import{r as a,o as n,e as h,b as t,u as w,w as i,F as x,L as F,q as v,Z as B,a as d,d as r,c,s as z,x as A,t as D,g as m,y as L,z as R}from"./app-DDJMr7vS.js";import{_ as J}from"./AuthenticatedLayout-BMbNCSTX.js";import"./sweetalert2.all-CLT0pA3l.js";import"./ApplicationLogo-CEhaCyMh.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const K=d("h2",{class:"font-semibold text-xl leading-tight"},"Categorias de Equipos",-1),G={class:"py-12"},M={class:"max-w-7xl mx-auto sm:px-4 lg:px-6"},Z={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},H={class:"text-h5"},Q={class:"d-flex justify-end"},W={class:"d-flex justify-between"},X=d("p",{class:"text-grey"},"Campos requeridos para el informe: ",-1),Y={key:1},ee=d("thead",null,[d("tr",null,[d("th",null,"Campo"),d("th",null,"Mostrar"),d("th",null,"Requerido")])],-1),te={key:2},ie=d("p",{class:"text-red"},[d("small",null,"No se han registrado campos requeridos para el informe.")],-1),se=[ie],le={components:{Toaster:F},props:{ct_equipments:{type:Array,required:!0}},data:()=>({search:"",dialog:!1,dialogDelete:!1,headers:[{title:"Categoria",key:"ct_equipment"},{title:"Descripción",key:"description"},{title:"Estado",key:"active"},{title:"Actions",key:"actions",sortable:!1}],editedIndex:-1,editedItem:{ct_equipment_uuid:"",ct_equipment:"",description:"",active:!1},defaultItem:{ct_equipment_uuid:"",ct_equipment:"",description:"",active:!1},showCreateField:!1,new_field:""}),computed:{formTitle(){return this.editedIndex===-1?"Nueva categoria":"Editar categoria"}},watch:{dialog(l){l||this.close()},dialogDelete(l){l||this.closeDelete()}},methods:{editItem(l){this.editedIndex=this.ct_equipments.indexOf(l),l.active=l.active=="1",this.editedItem=Object.assign({},l),this.editedItem.required_fields_report=JSON.parse(l.required_fields_report),this.dialog=!0},deleteItem(l){this.editedIndex=this.ct_equipments.indexOf(l),this.editedItem=Object.assign({},l),this.dialogDelete=!0},deleteItemConfirm(l){this.ct_equipments.splice(this.editedIndex,1);const e=()=>axios.delete("api/equipment/categories/"+l);v.promise(e,{loading:"Procesando...",success:o=>(this.closeDelete(),"Categoria eliminada correctamente"),error:o=>{this.handleErrors(o)}})},close(){this.dialog=!1,this.$nextTick(()=>{console.log("Cambiando estatus en close"),this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{console.log("Cambiando estatus en closeDelete"),this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save(){if(this.editedIndex>-1){Object.assign(this.ct_equipments[this.editedIndex],this.editedItem);const l=()=>axios.put("api/equipment/categories/"+this.editedItem.ct_equipment_uuid,{ct_equipment:this.editedItem.ct_equipment,description:this.editedItem.description,required_fields_report:JSON.stringify(this.editedItem.required_fields_report),active:this.editedItem.active});v.promise(l(),{loading:"Procesando...",success:e=>(this.$inertia.reload(),"Categoria actualizada correctamente"),error:e=>{this.handleErrors(e)}})}else{this.ct_equipments.push(this.editedItem);const l=()=>axios.post("api/equipment/categories",{ct_equipment:this.editedItem.ct_equipment,description:this.editedItem.description,required_fields_report:JSON.stringify(this.editedItem.required_fields_report),active:this.editedItem.active});v.promise(l(),{loading:"Procesando...",success:e=>(this.$inertia.reload(),this.close(),"Categoria creada correctamente"),error:e=>{this.handleErrors(e)}})}},getColor(l){return l?"green":"red"},addField(){if(this.new_field){this.editedItem.required_fields_report==null&&(this.editedItem.required_fields_report={fields:[]});let l=this.new_field.replace(/ /g,"_").toLowerCase();this.editedItem.required_fields_report.fields.push({key:l,name:this.new_field,type:"string",active:!0,required:!0}),this.new_field="",this.showCreateField=!1}else v.error("El campo no puede estar vacío")}}},ue=Object.assign(le,{__name:"EquipmentCategories",setup(l){return(e,o)=>{const g=a("v-icon"),q=a("v-text-field"),T=a("v-toolbar-title"),E=a("v-divider"),f=a("v-spacer"),u=a("v-btn"),I=a("v-card-title"),p=a("v-col"),O=a("v-textarea"),U=a("v-switch"),b=a("v-checkbox"),N=a("v-table"),k=a("v-row"),$=a("v-container"),P=a("v-card-text"),y=a("v-card-actions"),C=a("v-card"),V=a("v-dialog"),j=a("v-toolbar"),S=a("v-data-table");return n(),h(x,null,[t(w(F),{position:"top-right",richColors:"",visibleToasts:10}),t(w(B),{title:"Categorias de Equipos"}),t(J,null,{header:i(()=>[K]),default:i(()=>[d("div",G,[d("div",M,[d("div",Z,[t(C,null,{default:i(()=>[t(k,null,{default:i(()=>[t(p,{cols:"12",sm:"12"},{default:i(()=>[t(S,{headers:e.headers,items:l.ct_equipments,"fixed-header":"",search:e.search,mobile:e.isMobile()},{"item.active":i(({value:s})=>[t(g,{color:e.getColor(s)},{default:i(()=>[r("mdi-circle-slice-8")]),_:2},1032,["color"])]),top:i(()=>[t(j,{flat:""},{default:i(()=>[t(T,{class:"ml-1"},{default:i(()=>[t(q,{modelValue:e.search,"onUpdate:modelValue":o[0]||(o[0]=s=>e.search=s),label:"Buscar","hide-details":"",variant:"solo","append-inner-icon":"mdi-magnify",density:"compact"},null,8,["modelValue"])]),_:1}),t(E,{class:"mx-4",inset:"",vertical:""}),t(f),e.hasPermissionTo("equipments_categories.create")||e.hasPermissionTo("equipments_categories.update")?(n(),c(V,{key:0,modelValue:e.dialog,"onUpdate:modelValue":o[7]||(o[7]=s=>e.dialog=s),"max-width":"500px"},z({default:i(()=>[t(C,null,{default:i(()=>[t(I,null,{default:i(()=>[d("span",H,D(e.formTitle),1)]),_:1}),t(P,null,{default:i(()=>[t($,null,{default:i(()=>[t(k,null,{default:i(()=>[t(p,{cols:"12"},{default:i(()=>[t(q,{modelValue:e.editedItem.ct_equipment,"onUpdate:modelValue":o[1]||(o[1]=s=>e.editedItem.ct_equipment=s),label:"Nombre",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),t(p,{cols:"12"},{default:i(()=>[t(O,{modelValue:e.editedItem.description,"onUpdate:modelValue":o[2]||(o[2]=s=>e.editedItem.description=s),label:"Descripción",variant:"solo","hide-details":""},null,8,["modelValue"])]),_:1}),t(p,{cols:"12"},{default:i(()=>[t(U,{label:"Activo",modelValue:e.editedItem.active,"onUpdate:modelValue":o[3]||(o[3]=s=>e.editedItem.active=s),color:"primary","hide-details":""},null,8,["modelValue"])]),_:1}),t(p,{cols:"12"},{default:i(()=>[d("div",Q,[e.showCreateField?(n(),c(u,{key:0,density:"compact","prepend-icon":"mdi-close",class:"mb-1 pr-0 text-none text-red",variant:"plain",onClick:o[4]||(o[4]=s=>e.showCreateField=!1)},{default:i(()=>[r("Cancelar")]),_:1})):m("",!0),e.showCreateField?(n(),c(u,{key:1,density:"compact","prepend-icon":"mdi-content-save-check-outline",class:"mb-1 pr-0 text-none text-primary",variant:"plain",onClick:e.addField,disabled:!e.new_field},{default:i(()=>[r("Guardar")]),_:1},8,["onClick","disabled"])):m("",!0)]),e.showCreateField?(n(),c(q,{key:0,modelValue:e.new_field,"onUpdate:modelValue":o[5]||(o[5]=s=>e.new_field=s),label:"Campo",variant:"outlined","hide-details":"",onKeyup:L(e.addField,["enter"])},null,8,["modelValue","onKeyup"])):m("",!0),d("div",W,[X,e.showCreateField?m("",!0):(n(),c(u,{key:0,density:"compact","prepend-icon":"mdi-plus",class:"mb-1 pr-0 text-none text-primary",variant:"plain",onClick:o[6]||(o[6]=s=>e.showCreateField=!0)},{default:i(()=>[r("Agregar")]),_:1}))]),e.editedItem.required_fields_report?(n(),h("div",Y,[t(N,{density:"compact","fixed-header":"",class:"mt-4"},{default:i(()=>[ee,d("tbody",null,[(n(!0),h(x,null,R(e.editedItem.required_fields_report.fields,s=>(n(),h("tr",{key:s.key},[d("td",null,D(s.name),1),d("td",null,[t(b,{"hide-details":"",class:"py-0",modelValue:s.active,"onUpdate:modelValue":_=>s.active=_},null,8,["modelValue","onUpdate:modelValue"])]),d("td",null,[t(b,{"hide-details":"",class:"py-0",modelValue:s.required,"onUpdate:modelValue":_=>s.required=_},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]),_:1})])):(n(),h("div",te,se))]),_:1})]),_:1})]),_:1})]),_:1}),t(y,null,{default:i(()=>[t(f),t(u,{color:"blue-darken-1",variant:"text",onClick:e.close},{default:i(()=>[r(" Cerrar ")]),_:1},8,["onClick"]),t(u,{color:"blue-darken-1",variant:"text",onClick:e.save},{default:i(()=>[r(" Guardar ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:2},[e.hasPermissionTo("equipments_categories.create")?{name:"activator",fn:i(({props:s})=>[t(u,A({class:"mb-2",color:"primary",dark:""},s,{icon:"mdi-plus"}),null,16)]),key:"0"}:void 0]),1032,["modelValue"])):m("",!0),t(V,{modelValue:e.dialogDelete,"onUpdate:modelValue":o[9]||(o[9]=s=>e.dialogDelete=s),"max-width":"500px"},{default:i(()=>[t(C,null,{default:i(()=>[t(I,{class:"text-h5 text-center"},{default:i(()=>[r("¿Estás seguro de eliminar?")]),_:1}),t(y,null,{default:i(()=>[t(f),t(u,{color:"blue-darken-1",variant:"text",onClick:e.closeDelete},{default:i(()=>[r("Cancel")]),_:1},8,["onClick"]),t(u,{color:"blue-darken-1",variant:"text",onClick:o[8]||(o[8]=s=>e.deleteItemConfirm(e.editedItem.ct_equipment_uuid))},{default:i(()=>[r("Si, eliminar")]),_:1}),t(f)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.actions":i(({item:s})=>[e.hasPermissionTo("equipments_categories.update")?(n(),c(g,{key:0,class:"me-2",size:"small",onClick:_=>e.editItem(s)},{default:i(()=>[r(" mdi-pencil ")]),_:2},1032,["onClick"])):m("",!0),e.hasPermissionTo("equipments_categories.delete")?(n(),c(g,{key:1,size:"small",onClick:_=>e.deleteItem(s)},{default:i(()=>[r(" mdi-delete ")]),_:2},1032,["onClick"])):m("",!0)]),_:1},8,["headers","items","search","mobile"])]),_:1})]),_:1})]),_:1})])])])]),_:1})],64)}}});export{ue as default};
