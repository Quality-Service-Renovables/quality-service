import{r as f,o as V,e as z,b as l,u as U,w as i,F as H,L as S,H as w,q as T,Z,a as M,d as C,c as R,s as J,x as G,t as K,f as Q,g as A,p as X,h as Y}from"./app-CdXlW3h5.js";import{_ as x}from"./AuthenticatedLayout-DwxykK97.js";import{v as ee,p as te,a as se}from"./filepond-plugin-image-preview.esm-dR7flX8A.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ApplicationLogo-DHcIPpdZ.js";var oe=Object.defineProperty,le=(t,e,s)=>e in t?oe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,N=(t,e,s)=>(le(t,typeof e!="symbol"?e+"":e,s),s);const L={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}},D=(t,e,s)=>t.replaceAll(e,"").replace(s,".").replace("..",".").replace(/[^.\d]/g,""),O=(t,e,s)=>{var a;return new Intl.NumberFormat(((a=s.number)==null?void 0:a.locale)??"en",{minimumFractionDigits:t,maximumFractionDigits:e,roundingMode:"trunc"})},ie=(t,e=!0,s)=>{var a,o,r,h;const c=((a=s.number)==null?void 0:a.unsigned)==null&&t.startsWith("-")?"-":"",m=((o=s.number)==null?void 0:o.fraction)??0;let u=O(0,m,s);const p=u.formatToParts(1000.12),v=((r=p.find(d=>d.type==="group"))==null?void 0:r.value)??" ",P=((h=p.find(d=>d.type==="decimal"))==null?void 0:h.value)??".",b=D(t,v,P);if(b===""||Number.isNaN(b))return c;const y=b.split(".");if(y[1]!=null&&y[1].length>=1){const d=y[1].length<=m?y[1].length:m;u=O(d,m,s)}let k=u.format(parseFloat(b));return e?m>0&&b.endsWith(".")&&!b.slice(0,-1).includes(".")&&(k+=P):k=D(k,v,P),c+k};class re{constructor(e={}){N(this,"opts",{}),N(this,"memo",new Map);const s={...e};if(s.tokens!=null){s.tokens=s.tokensReplace?{...s.tokens}:{...L,...s.tokens};for(const a of Object.values(s.tokens))typeof a.pattern=="string"&&(a.pattern=new RegExp(a.pattern))}else s.tokens=L;Array.isArray(s.mask)&&(s.mask.length>1?s.mask=[...s.mask].sort((a,o)=>a.length-o.length):s.mask=s.mask[0]??""),s.mask===""&&(s.mask=null),this.opts=s}masked(e){return this.process(e,this.findMask(e))}unmasked(e){return this.process(e,this.findMask(e),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(e){const s=this.findMask(e);if(this.opts.mask==null||s==null)return!1;const a=this.process(e,s).length;return typeof this.opts.mask=="string"?a>=this.opts.mask.length:typeof this.opts.mask=="function"?a>=s.length:this.opts.mask.filter(o=>a>=o.length).length===this.opts.mask.length}findMask(e){const s=this.opts.mask;if(s==null)return null;if(typeof s=="string")return s;if(typeof s=="function")return s(e);const a=this.process(e,s.slice(-1).pop()??"",!1);return s.find(o=>this.process(e,o,!1).length>=a.length)??""}escapeMask(e){const s=[],a=[];return e.split("").forEach((o,r)=>{o==="!"&&e[r-1]!=="!"?a.push(r-a.length):s.push(o)}),{mask:s.join(""),escaped:a}}process(e,s,a=!0){if(this.opts.number!=null)return ie(e,a,this.opts);if(s==null)return e;const o=`v=${e},mr=${s},m=${a?1:0}`;if(this.memo.has(o))return this.memo.get(o);const{mask:r,escaped:h}=this.escapeMask(s),c=[],m=this.opts.tokens!=null?this.opts.tokens:{},u=this.isReversed()?-1:1,p=this.isReversed()?"unshift":"push",v=this.isReversed()?0:r.length-1,P=this.isReversed()?()=>d>-1&&g>-1:()=>d<r.length&&g<e.length,b=_=>!this.isReversed()&&_<=v||this.isReversed()&&_>=v;let y,k=-1,d=this.isReversed()?r.length-1:0,g=this.isReversed()?e.length-1:0,E=!1;for(;P();){const _=r.charAt(d),I=m[_],n=(I==null?void 0:I.transform)!=null?I.transform(e.charAt(g)):e.charAt(g);if(!h.includes(d)&&I!=null?(n.match(I.pattern)!=null?(c[p](n),I.repeated?(k===-1?k=d:d===v&&d!==k&&(d=k-u),v===k&&(d-=u)):I.multiple&&(E=!0,d-=u),d+=u):I.multiple?E&&(d+=u,g-=u,E=!1):n===y?y=void 0:I.optional&&(d+=u,g-=u),g+=u):(a&&!this.isEager()&&c[p](_),n===_&&!this.isEager()?g+=u:y=_,this.isEager()||(d+=u)),this.isEager())for(;b(d)&&(m[r.charAt(d)]==null||h.includes(d));){if(a){if(c[p](r.charAt(d)),e.charAt(g)===r.charAt(d)){d+=u,g+=u;continue}}else r.charAt(d)===e.charAt(g)&&(g+=u);d+=u}}return this.memo.set(o,c.join("")),this.memo.get(o)}}const $=t=>JSON.parse(t.replaceAll("'",'"')),ne=(t,e={})=>{const s={...e};t.dataset.maska!=null&&t.dataset.maska!==""&&(s.mask=de(t.dataset.maska)),t.dataset.maskaEager!=null&&(s.eager=F(t.dataset.maskaEager)),t.dataset.maskaReversed!=null&&(s.reversed=F(t.dataset.maskaReversed)),t.dataset.maskaTokensReplace!=null&&(s.tokensReplace=F(t.dataset.maskaTokensReplace)),t.dataset.maskaTokens!=null&&(s.tokens=ue(t.dataset.maskaTokens));const a={};return t.dataset.maskaNumberLocale!=null&&(a.locale=t.dataset.maskaNumberLocale),t.dataset.maskaNumberFraction!=null&&(a.fraction=parseInt(t.dataset.maskaNumberFraction)),t.dataset.maskaNumberUnsigned!=null&&(a.unsigned=F(t.dataset.maskaNumberUnsigned)),(t.dataset.maskaNumber!=null||Object.values(a).length>0)&&(s.number=a),s},F=t=>t!==""?!!JSON.parse(t):!0,de=t=>t.startsWith("[")&&t.endsWith("]")?$(t):t,ue=t=>{if(t.startsWith("{")&&t.endsWith("}"))return $(t);const e={};return t.split("|").forEach(s=>{const a=s.split(":");e[a[0]]={pattern:new RegExp(a[1]),optional:a[2]==="optional",multiple:a[2]==="multiple",repeated:a[2]==="repeated"}}),e};class me{constructor(e,s={}){N(this,"items",new Map),N(this,"onInput",a=>{if(a instanceof CustomEvent&&a.type==="input")return;const o=a.target,r=this.items.get(o),h="inputType"in a&&a.inputType.startsWith("delete"),c=r.isEager(),m=h&&c&&r.unmasked(o.value)===""?"":o.value;this.fixCursor(o,h,()=>this.setValue(o,m))}),this.options=s,this.init(this.getInputs(e))}update(e={}){this.options={...e},this.init(Array.from(this.items.keys()))}updateValue(e){e.value!==""&&e.value!==this.processInput(e).masked&&this.setValue(e,e.value)}destroy(){for(const e of this.items.keys())e.removeEventListener("input",this.onInput);this.items.clear()}init(e){const s=this.getOptions(this.options);for(const a of e){this.items.has(a)||a.addEventListener("input",this.onInput,{capture:!0});const o=new re(ne(a,s));this.items.set(a,o),queueMicrotask(()=>this.updateValue(a)),a.selectionStart===null&&o.isEager()&&console.warn("Maska: input of `%s` type is not supported",a.type)}}getInputs(e){return typeof e=="string"?Array.from(document.querySelectorAll(e)):"length"in e?Array.from(e):[e]}getOptions(e){const{onMaska:s,preProcess:a,postProcess:o,...r}=e;return r}fixCursor(e,s,a){const o=e.selectionStart,r=e.value;if(a(),o===null||o===r.length&&!s)return;const h=e.value,c=r.slice(0,o),m=h.slice(0,o),u=this.processInput(e,c).unmasked,p=this.processInput(e,m).unmasked;let v=o;c!==m&&(v+=s?h.length-r.length:u.length-p.length),e.setSelectionRange(v,v)}setValue(e,s){const a=this.processInput(e,s);e.value=a.masked,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(o=>o(a)):this.options.onMaska(a)),e.dispatchEvent(new CustomEvent("maska",{detail:a})),e.dispatchEvent(new CustomEvent("input",{detail:a.masked}))}processInput(e,s){const a=this.items.get(e);let o=s??e.value;this.options.preProcess!=null&&(o=this.options.preProcess(o));let r=a.masked(o);return this.options.postProcess!=null&&(r=this.options.postProcess(r)),{masked:r,unmasked:a.unmasked(o),completed:a.completed(o)}}}const q=new WeakMap,ce=(t,e)=>{if(t.arg==null||t.instance==null)return;const s="setup"in t.instance.$.type;t.arg in t.instance?t.instance[t.arg]=e:s&&console.warn("Maska: please expose `%s` using defineExpose",t.arg)},j=(t,e)=>{var s;const a=t instanceof HTMLInputElement?t:t.querySelector("input");if(a==null||(a==null?void 0:a.type)==="file")return;let o={};if(e.value!=null&&(o=typeof e.value=="string"?{mask:e.value}:{...e.value}),e.arg!=null){const r=h=>{const c=e.modifiers.unmasked?h.unmasked:e.modifiers.completed?h.completed:h.masked;ce(e,c)};o.onMaska=o.onMaska==null?r:Array.isArray(o.onMaska)?[...o.onMaska,r]:[o.onMaska,r]}q.has(a)?(s=q.get(a))==null||s.update(o):q.set(a,new me(a,o))},pe=t=>(X("data-v-5bd60fb7"),t=t(),Y(),t),he=pe(()=>M("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},"Usuarios",-1)),fe={class:"py-12"},ge={class:"max-w-7xl mx-auto sm:px-4 lg:px-6"},ve={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ke={class:"text-h5"},B=ee(se,te),be={directives:{maska:j},components:{Toaster:S,FilePond:B},props:{users:{type:Array,required:!0}},data(){return{search:"",dialog:!1,dialogDelete:!1,headers:[{title:"Usuario",key:"name"},{title:"Email",key:"email"},{title:"Teléfono",key:"phone"},{title:"Cliente",key:"client.client"},{title:"Rol",key:"roles[0].description"},{title:"Estado",key:"active"},{title:"Actions",key:"actions",sortable:!1}],editedIndex:-1,editedItem:{uuid:"",name:"",email:"",image_profile:"",phone:"",password:"",password_confirm:"",client_uuid:"",rol:"",active:!1},defaultItem:{uuid:"",name:"",email:"",image_profile:"",phone:"",password:"",password_confirm:"",client_uuid:"",rol:"",active:!1},roles:[],clients:[],myFiles:[],serverConfig:{process:(t,e,s,a,o,r,h)=>{this.editedItem.image_profile=e;const m=w.CancelToken.source();this.updatePhoto(m,a,o,r)}},options:{mask:"###-###-####",eager:!0},rules:{required:t=>!!t||"Requerido.",email:t=>t?/.+@.+\..+/.test(t)?!0:"Email inválido.":"Requerido.",password:t=>t.length<8?"La contraseña debe tener al menos 8 caracteres.":!0,password_confirm:t=>this.editedItem.password!==""&&this.editedItem.password===this.editedItem.password_confirm?!0:"Las contraseñas no coinciden."}}},computed:{formTitle(){return this.editedIndex===-1?"Nuevo usuario":"Editar usuario"}},watch:{dialog(t){t||this.close()},dialogDelete(t){t||this.closeDelete()}},methods:{editItem(t){this.editedIndex=this.users.indexOf(t),t.active=t.active=="1",t.client_uuid=t.client.client_uuid,t.rol=t.roles[0].name,t.image_profile&&this.setImage(t.image_profile),this.editedItem=Object.assign({},t),this.dialog=!0},setImage(t){this.myFiles=[{source:t,options:{type:"remote"}}]},deleteItem(t){this.editedIndex=this.users.indexOf(t),this.editedItem=Object.assign({},t),this.dialogDelete=!0},deleteItemConfirm(t){const e=()=>w.delete("api/users/"+t);T.promise(e,{loading:"Procesando...",success:s=>(this.closeDelete(),this.$inertia.reload(),"Usuario eliminado correctamente"),error:s=>{this.handleErrors(s)}})},close(){this.dialog=!1,this.$nextTick(()=>{console.log("Cambiando estatus en close"),this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1,this.myFiles=[]})},closeDelete(){this.dialogDelete=!1,this.$nextTick(()=>{console.log("Cambiando estatus en closeDelete"),this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1})},save(){if(this.editedItem.phone=this.editedItem.phone?this.editedItem.phone.replace(/-/g,""):null,this.editedIndex>-1){const t=()=>w.post("api/users/update/"+this.editedItem.uuid,this.editedItem);T.promise(t(),{loading:"Procesando...",success:e=>(this.$inertia.reload(),this.close(),"Usuario actualizado correctamente"),error:e=>{this.handleErrors(e)}})}else{const t=()=>w.post("api/users",this.editedItem);T.promise(t(),{loading:"Procesando...",success:e=>(this.$inertia.reload(),this.close(),"Usuario creado correctamente"),error:e=>{this.handleErrors(e)}})}},getColor(t){return t?"green":"red"},getRoles(){w.get("api/auth-guard/roles").then(t=>{this.roles=t.data.data}).catch(t=>{T.error("Error al cargar los roles")})},getClients(){w.get("api/clients").then(t=>{this.clients=t.data.data}).catch(t=>{T.error("Error al cargar los clientes")})},updatePhoto(t,e,s,a){return w.post("api/users/update-picture/"+this.editedItem.uuid,this.editedItem,{headers:{"Content-Type":"multipart/form-data"},cancelToken:t.token,onUploadProgress:o=>{a(o.lengthComputable,o.loaded,o.total)}}).then(o=>{e(o.data.fileId),setTimeout(()=>{console.log("Se actualizó la foto de perfil"),this.$inertia.reload(),this.setImage(o.data.data.image_profile)},1500)}).catch(o=>{w.isCancel(o)?this.abort(t):(s("Error al subir la foto."),this.handleErrors(o))})},checkPassword(){return this.editedItem.password!==""&&this.editedItem.password===this.editedItem.password_confirm}},mounted(){this.getRoles(),this.getClients()}},Ie=Object.assign(be,{__name:"User",setup(t){return(e,s)=>{const a=f("v-icon"),o=f("v-text-field"),r=f("v-toolbar-title"),h=f("v-divider"),c=f("v-spacer"),m=f("v-btn"),u=f("v-card-title"),p=f("v-col"),v=f("v-select"),P=f("v-switch"),b=f("v-row"),y=f("v-container"),k=f("v-card-text"),d=f("v-card-actions"),g=f("v-card"),E=f("v-dialog"),_=f("v-toolbar"),I=f("v-data-table");return V(),z(H,null,[l(U(S),{position:"top-right",richColors:"",visibleToasts:10}),l(U(Z),{title:"Usuarios"}),l(x,null,{header:i(()=>[he]),default:i(()=>[M("div",fe,[M("div",ge,[M("div",ve,[l(g,null,{default:i(()=>[l(b,null,{default:i(()=>[l(p,{cols:"12",sm:"12"},{default:i(()=>[l(I,{headers:e.headers,items:t.users,"fixed-header":"",search:e.search},{"item.active":i(({value:n})=>[l(a,{color:e.getColor(n)},{default:i(()=>[C("mdi-circle-slice-8")]),_:2},1032,["color"])]),top:i(()=>[l(_,{flat:""},{default:i(()=>[l(r,{class:"ml-1"},{default:i(()=>[l(o,{modelValue:e.search,"onUpdate:modelValue":s[0]||(s[0]=n=>e.search=n),label:"Buscar","hide-details":"",variant:"solo","append-inner-icon":"mdi-magnify",density:"compact"},null,8,["modelValue"])]),_:1}),l(h,{class:"mx-4",inset:"",vertical:""}),l(c),e.hasPermissionTo("users.create")||e.hasPermissionTo("users.update")?(V(),R(E,{key:0,modelValue:e.dialog,"onUpdate:modelValue":s[9]||(s[9]=n=>e.dialog=n),width:"auto",scrollable:""},J({default:i(()=>[l(g,{"max-width":"100%"},{default:i(()=>[l(u,null,{default:i(()=>[M("span",ke,K(e.formTitle),1)]),_:1}),l(k,null,{default:i(()=>[l(y,null,{default:i(()=>[l(b,{class:"justify-center align-center"},{default:i(()=>[l(p,{cols:"12",lg:"4"},{default:i(()=>[l(U(B),{name:"evidence",ref:"pond","label-idle":"Arrastra y suelta tu archivo o <span class='filepond--label-action'>selecciona</span>","allow-multiple":!1,"accepted-file-types":"image/jpeg, image/png",files:e.myFiles,onInit:e.handleFilePondInit,server:e.serverConfig,instantUpload:"false",allowProcess:"true",allowReplace:"true",allowImagePreview:"true",allowUndo:"false",labelInvalidField:"Tipo de archivo no permitido",labelFileLoading:"Cargando",labelFileLoadError:"Error al subir el archivo",labelFileProcessing:"Procesando",labelFileProcessingComplete:"Proceso completado",labelFileProcessingAborted:"Proceso abortado",labelFileProcessingError:"Error al procesar",labelTapToCancel:"Toca para cancelar",labelTapToRetry:"Toca para reintentar",labelTapToUndo:"",labelButtonAbortItemLoad:"Cancelar",labelButtonRetryItemLoad:"Reintentar",labelButtonAbortItemProcessing:"Cancelar",labelButtonProcessItem:"Subir",imagePreviewHeight:"170",imageCropAspectRatio:"1:1",imageResizeTargetWidth:"200",imageResizeTargetHeight:"200",stylePanelLayout:"compact circle",styleLoadIndicatorPosition:"center bottom",styleButtonRemoveItemPosition:"left bottom",styleButtonProcessItemPosition:"right bottom",styleProgressIndicatorPosition:"right bottom","max-width":"200"},null,8,["files","onInit","server"])]),_:1}),l(p,{cols:"12"},{default:i(()=>[l(o,{modelValue:e.editedItem.name,"onUpdate:modelValue":s[1]||(s[1]=n=>e.editedItem.name=n),label:"Nombre",variant:"outlined",rules:[e.rules.required]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12",lg:"6"},{default:i(()=>[l(o,{modelValue:e.editedItem.email,"onUpdate:modelValue":s[2]||(s[2]=n=>e.editedItem.email=n),label:"Email",variant:"outlined",rules:[e.rules.required,e.rules.email]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12",lg:"6"},{default:i(()=>[Q(l(o,{modelValue:e.editedItem.phone,"onUpdate:modelValue":s[3]||(s[3]=n=>e.editedItem.phone=n),label:"Teléfono (opcional)","data-maska-reversed":"",variant:"outlined"},null,8,["modelValue"]),[[U(j),e.options]])]),_:1}),l(p,{cols:"12",lg:"6"},{default:i(()=>[l(v,{modelValue:e.editedItem.client_uuid,"onUpdate:modelValue":s[4]||(s[4]=n=>e.editedItem.client_uuid=n),items:e.clients,label:"Cliente","item-title":"client","item-value":"client_uuid",dense:"",variant:"outlined",rules:[e.rules.required]},null,8,["modelValue","items","rules"])]),_:1}),l(p,{cols:"12",lg:"6"},{default:i(()=>[l(v,{modelValue:e.editedItem.rol,"onUpdate:modelValue":s[5]||(s[5]=n=>e.editedItem.rol=n),items:e.roles,label:"Rol","item-title":"description","item-value":"name",dense:"",variant:"outlined",rules:[e.rules.required]},null,8,["modelValue","items","rules"])]),_:1}),e.editedIndex==-1?(V(),R(p,{key:0,cols:"12",lg:"6"},{default:i(()=>[l(o,{modelValue:e.editedItem.password,"onUpdate:modelValue":s[6]||(s[6]=n=>e.editedItem.password=n),label:"Contraseña",type:"password",variant:"outlined",rules:[e.rules.required,e.rules.password],required:""},null,8,["modelValue","rules"])]),_:1})):A("",!0),e.editedIndex==-1?(V(),R(p,{key:1,cols:"12",lg:"6"},{default:i(()=>[l(o,{modelValue:e.editedItem.password_confirm,"onUpdate:modelValue":s[7]||(s[7]=n=>e.editedItem.password_confirm=n),label:"Confirmar contraseña",type:"password",variant:"outlined",rules:[e.rules.required,e.rules.password_confirm],required:""},null,8,["modelValue","rules"])]),_:1})):A("",!0),l(p,{cols:"12",lg:"3"},{default:i(()=>[l(P,{label:"Activo",modelValue:e.editedItem.active,"onUpdate:modelValue":s[8]||(s[8]=n=>e.editedItem.active=n),color:"primary",readonly:e.editedItem.roles&&e.editedItem.roles[0].name==="admin"},null,8,["modelValue","readonly"])]),_:1})]),_:1})]),_:1})]),_:1}),l(d,null,{default:i(()=>[l(c),l(m,{color:"blue-darken-1",variant:"text",onClick:e.close},{default:i(()=>[C(" Cancelar ")]),_:1},8,["onClick"]),l(m,{color:"blue-darken-1",variant:"text",onClick:e.save},{default:i(()=>[C(" Guardar ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:2},[e.hasPermissionTo("users.create")?{name:"activator",fn:i(({props:n})=>[l(m,G({class:"mb-2",color:"primary",dark:""},n,{icon:"mdi-plus"}),null,16)]),key:"0"}:void 0]),1032,["modelValue"])):A("",!0),l(E,{modelValue:e.dialogDelete,"onUpdate:modelValue":s[11]||(s[11]=n=>e.dialogDelete=n),"max-width":"500px"},{default:i(()=>[l(g,null,{default:i(()=>[l(u,{class:"text-h5 text-center"},{default:i(()=>[C("¿Estás seguro de eliminar?")]),_:1}),l(d,null,{default:i(()=>[l(c),l(m,{color:"blue-darken-1",variant:"text",onClick:e.closeDelete},{default:i(()=>[C("Cancel")]),_:1},8,["onClick"]),l(m,{color:"blue-darken-1",variant:"text",onClick:s[10]||(s[10]=n=>e.deleteItemConfirm(e.editedItem.uuid))},{default:i(()=>[C("Si, eliminar")]),_:1}),l(c)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),"item.actions":i(({item:n})=>[e.hasPermissionTo("users.update")?(V(),R(a,{key:0,class:"me-2",size:"small",onClick:W=>e.editItem(n)},{default:i(()=>[C(" mdi-pencil ")]),_:2},1032,["onClick"])):A("",!0),e.hasPermissionTo("users.delete")&&n.roles[0].name!="admin"?(V(),R(a,{key:1,size:"small",onClick:W=>e.deleteItem(n)},{default:i(()=>[C(" mdi-delete ")]),_:2},1032,["onClick"])):A("",!0)]),_:1},8,["headers","items","search"])]),_:1})]),_:1})]),_:1})])])])]),_:1})],64)}}}),Ee=ae(Ie,[["__scopeId","data-v-5bd60fb7"]]);export{Ee as default};
